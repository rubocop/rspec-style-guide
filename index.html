<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.18">
<title>RSpec Style Guide</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.square{list-style-type:square}
ul.circle ul:not([class]),ul.disc ul:not([class]),ul.square ul:not([class]){list-style:inherit}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<style>
pre.rouge table td { padding: 5px; }
pre.rouge table pre { margin: 0; }
pre.rouge .cm {
  color: #999988;
  font-style: italic;
}
pre.rouge .cp {
  color: #999999;
  font-weight: bold;
}
pre.rouge .c1 {
  color: #999988;
  font-style: italic;
}
pre.rouge .cs {
  color: #999999;
  font-weight: bold;
  font-style: italic;
}
pre.rouge .c, pre.rouge .cd {
  color: #999988;
  font-style: italic;
}
pre.rouge .err {
  color: #a61717;
  background-color: #e3d2d2;
}
pre.rouge .gd {
  color: #000000;
  background-color: #ffdddd;
}
pre.rouge .ge {
  color: #000000;
  font-style: italic;
}
pre.rouge .gr {
  color: #aa0000;
}
pre.rouge .gh {
  color: #999999;
}
pre.rouge .gi {
  color: #000000;
  background-color: #ddffdd;
}
pre.rouge .go {
  color: #888888;
}
pre.rouge .gp {
  color: #555555;
}
pre.rouge .gs {
  font-weight: bold;
}
pre.rouge .gu {
  color: #aaaaaa;
}
pre.rouge .gt {
  color: #aa0000;
}
pre.rouge .kc {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kd {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kn {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kp {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kr {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kt {
  color: #445588;
  font-weight: bold;
}
pre.rouge .k, pre.rouge .kv {
  color: #000000;
  font-weight: bold;
}
pre.rouge .mf {
  color: #009999;
}
pre.rouge .mh {
  color: #009999;
}
pre.rouge .il {
  color: #009999;
}
pre.rouge .mi {
  color: #009999;
}
pre.rouge .mo {
  color: #009999;
}
pre.rouge .m, pre.rouge .mb, pre.rouge .mx {
  color: #009999;
}
pre.rouge .sb {
  color: #d14;
}
pre.rouge .sc {
  color: #d14;
}
pre.rouge .sd {
  color: #d14;
}
pre.rouge .s2 {
  color: #d14;
}
pre.rouge .se {
  color: #d14;
}
pre.rouge .sh {
  color: #d14;
}
pre.rouge .si {
  color: #d14;
}
pre.rouge .sx {
  color: #d14;
}
pre.rouge .sr {
  color: #009926;
}
pre.rouge .s1 {
  color: #d14;
}
pre.rouge .ss {
  color: #990073;
}
pre.rouge .s {
  color: #d14;
}
pre.rouge .na {
  color: #008080;
}
pre.rouge .bp {
  color: #999999;
}
pre.rouge .nb {
  color: #0086B3;
}
pre.rouge .nc {
  color: #445588;
  font-weight: bold;
}
pre.rouge .no {
  color: #008080;
}
pre.rouge .nd {
  color: #3c5d5d;
  font-weight: bold;
}
pre.rouge .ni {
  color: #800080;
}
pre.rouge .ne {
  color: #990000;
  font-weight: bold;
}
pre.rouge .nf {
  color: #990000;
  font-weight: bold;
}
pre.rouge .nl {
  color: #990000;
  font-weight: bold;
}
pre.rouge .nn {
  color: #555555;
}
pre.rouge .nt {
  color: #000080;
}
pre.rouge .vc {
  color: #008080;
}
pre.rouge .vg {
  color: #008080;
}
pre.rouge .vi {
  color: #008080;
}
pre.rouge .nv {
  color: #008080;
}
pre.rouge .ow {
  color: #000000;
  font-weight: bold;
}
pre.rouge .o {
  color: #000000;
  font-weight: bold;
}
pre.rouge .w {
  color: #bbbbbb;
}
pre.rouge {
  background-color: #f8f8f8;
}
</style>
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>RSpec Style Guide</h1>
<div id="toc" class="toc2">
<div id="toctitle"><h2>Table of Contents</h2></div>
<ul class="sectlevel1">
<li><a href="#introduction">Introduction</a></li>
<li><a href="#how-to-read-this-guide">How to Read This Guide</a></li>
<li><a href="#a-living-document">A Living Document</a></li>
<li><a href="#layout">Layout</a>
<ul class="sectlevel2">
<li><a href="#empty-lines-inside-example-group">Empty Lines inside Example Group</a></li>
<li><a href="#empty-lines-between-describes">Empty Line between Example Groups</a></li>
<li><a href="#empty-line-after-let">Empty Line After <code>let</code></a></li>
<li><a href="#let-grouping">Let Grouping</a></li>
<li><a href="#empty-lines-around-examples">Empty Lines around Examples</a></li>
<li><a href="#leading-subject">Leading <code>subject</code></a></li>
</ul>
</li>
<li><a href="#example-group-structure">Example Group Structure</a>
<ul class="sectlevel2">
<li><a href="#use-contexts">Use Contexts</a></li>
<li><a href="#context-cases">Context Cases</a></li>
<li><a href="#let-blocks"><code>let</code> Blocks</a></li>
<li><a href="#instance-variables">Instance Variables</a></li>
<li><a href="#shared-examples">Shared Examples</a></li>
<li><a href="#redundant-beforeeach">Redundant <code>before(:each)</code></a></li>
<li><a href="#ambiguous-hook-scope">Ambiguous Hook Scope</a></li>
<li><a href="#avoid-hooks-with-context-scope">Avoid Hooks with <code>:context</code> Scope</a></li>
</ul>
</li>
<li><a href="#example-structure">Example Structure</a>
<ul class="sectlevel2">
<li><a href="#expectation-per-example">Expectation per Example</a></li>
<li><a href="#subject">Subject</a></li>
<li><a href="#use-subject">Named Subject</a></li>
<li><a href="#subject-naming-in-context">Subject Naming in Context</a></li>
<li><a href="#dont-stub-subject">Don&#8217;t Stub Subject</a></li>
<li><a href="#it-and-specify"><code>it</code> and <code>specify</code></a></li>
<li><a href="#it-in-iterators"><code>it</code> in Iterators</a></li>
<li><a href="#incidental-state">Incidental State</a></li>
<li><a href="#dry">DRY</a></li>
<li><a href="#factories">Factories</a></li>
<li><a href="#needed-data">Needed Data</a></li>
<li><a href="#doubles">Doubles</a></li>
<li><a href="#dealing-with-time">Dealing with Time</a></li>
<li><a href="#stub-http-requests">Stub HTTP Requests</a></li>
<li><a href="#declare-constants">Declare Constants</a></li>
<li><a href="#implicit-block-expectations">Implicit Block Expectations</a></li>
</ul>
</li>
<li><a href="#naming">Naming</a>
<ul class="sectlevel2">
<li><a href="#context-descriptions">Context Descriptions</a></li>
<li><a href="#example-descriptions">Example Descriptions</a></li>
<li><a href="#keep-example-descriptions-short">Keep Example Descriptions Short</a></li>
<li><a href="#should-in-example-docstrings">"Should" in Example Docstrings</a></li>
<li><a href="#describe-the-methods">Describe the Methods</a></li>
<li><a href="#use-expect">Use <code>expect</code></a></li>
</ul>
</li>
<li><a href="#matchers">Matchers</a>
<ul class="sectlevel2">
<li><a href="#predicate-matchers">Predicate Matchers</a></li>
<li><a href="#built-in-matchers">Built in Matchers</a></li>
<li><a href="#be-matcher"><code>be</code> Matcher</a></li>
<li><a href="#extract-common-expectation-parts-into-matchers">Extract Common Expectation Parts into Matchers</a></li>
<li><a href="#any_instance_of"><code>any_instance_of</code></a></li>
<li><a href="#matcher-libraries">Matcher Libraries</a></li>
</ul>
</li>
<li><a href="#rails-integration">Rails: Integration</a></li>
<li><a href="#rails-views">Rails: Views</a>
<ul class="sectlevel2">
<li><a href="#view-directory-structure">View Directory Structure</a></li>
<li><a href="#view-spec-file-name">View Spec File Name</a></li>
<li><a href="#view-outer-describe">View Outer <code>describe</code></a></li>
<li><a href="#view-mock-models">View Mock Models</a></li>
<li><a href="#view-assign">View <code>assign</code></a></li>
<li><a href="#capybara-negative-selectors">Capybara Negative Selectors</a></li>
<li><a href="#view-helper-stub">View Helper Stub</a></li>
<li><a href="#view-helpers">View Helpers</a></li>
</ul>
</li>
<li><a href="#rails-controllers">Rails: Controllers</a>
<ul class="sectlevel2">
<li><a href="#controller-models">Controller Models</a></li>
<li><a href="#controller-behaviour">Controller Behaviour</a></li>
<li><a href="#controller-contexts">Controller Contexts</a></li>
</ul>
</li>
<li><a href="#rails-models">Rails: Models</a>
<ul class="sectlevel2">
<li><a href="#model-mocks">Model Mocks</a></li>
<li><a href="#model-objects">Model Objects</a></li>
<li><a href="#model-mock-associations">Model Mock Associations</a></li>
<li><a href="#avoid-duplication-in-model-tests">Avoid Duplication in Model Tests</a></li>
<li><a href="#check-model-validity">Check Model Validity</a></li>
<li><a href="#model-validations">Model Validations</a></li>
<li><a href="#separate-example-group-for-attribute-validations">Separate Example Group for Attribute Validations</a></li>
<li><a href="#naming-another-object">Naming Another Object</a></li>
</ul>
</li>
<li><a href="#rails-mailers">Rails: Mailers</a>
<ul class="sectlevel2">
<li><a href="#mailer-mock-model">Mailer Mock Model</a></li>
<li><a href="#mailer-expectations">Mailer Expectations</a></li>
</ul>
</li>
<li><a href="#recommendations">Recommendations</a>
<ul class="sectlevel2">
<li><a href="#correct-setup">Correct Setup</a></li>
</ul>
</li>
<li><a href="#related-guides">Related Guides</a></li>
<li><a href="#contributing">Contributing</a>
<ul class="sectlevel2">
<li><a href="#how-to-contribute">How to Contribute?</a></li>
</ul>
</li>
<li><a href="#license">License</a></li>
<li><a href="#credit">Credit</a></li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="introduction"><a class="anchor" href="#introduction"></a><a class="link" href="#introduction">Introduction</a></h2>
<div class="sectionbody">
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Role models are important.</p>
</div>
</blockquote>
<div class="attribution">
&#8212; Officer Alex J. Murphy / RoboCop
</div>
</div>
<div class="paragraph">
<p>This RSpec style guide outlines the recommended best practices for real-world programmers to write code that can be maintained by other real-world programmers.</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/rubocop-hq/rubocop">RuboCop</a>, a static code analyzer (linter) and formatter, has a <a href="https://github.com/rubocop-hq/rubocop-rspec"><code>rubocop-rspec</code></a> extension, provides a way to enforce the rules outlined in this guide.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
This guide assumes you are using RSpec 3 or later.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can generate a PDF copy of this guide using <a href="https://asciidoctor.org/docs/asciidoctor-pdf/">AsciiDoctor PDF</a>, and an HTML copy <a href="https://asciidoctor.org/docs/convert-documents/#converting-a-document-to-html">with</a> <a href="https://asciidoctor.org/#installation">AsciiDoctor</a> using the following commands:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># Generates README.pdf</span>
asciidoctor-pdf <span class="nt">-a</span> allow-uri-read README.adoc

<span class="c"># Generates README.html</span>
asciidoctor README.adoc</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>Install the <code>rouge</code> gem to get nice syntax highlighting in the generated document.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell">gem <span class="nb">install </span>rouge</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="how-to-read-this-guide"><a class="anchor" href="#how-to-read-this-guide"></a><a class="link" href="#how-to-read-this-guide">How to Read This Guide</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>The guide is separated into sections based on the different pieces of an entire spec file. There was an attempt to omit all obvious information, if anything is unclear, feel free to open an issue asking for further clarity.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="a-living-document"><a class="anchor" href="#a-living-document"></a><a class="link" href="#a-living-document">A Living Document</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Per the comment above, this guide is a work in progress - some rules are simply lacking thorough examples, but some things in the RSpec world change week by week or month by month.
With that said, as the standard changes this guide is meant to be able to change with it.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="layout"><a class="anchor" href="#layout"></a><a class="link" href="#layout">Layout</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="empty-lines-inside-example-group"><a class="anchor" href="#empty-lines-inside-example-group"></a><a class="link" href="#empty-lines-inside-example-group">Empty Lines inside Example Group<a id="empty-lines-after-describe"></a></a></h3>
<div class="paragraph">
<p>Do not leave empty lines after <code>feature</code>, <code>context</code> or <code>describe</code> descriptions.
It doesn&#8217;t make the code more readable and lowers the value of logical chunks.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="ruby"><span class="c1"># bad</span>
<span class="n">describe</span> <span class="no">Article</span> <span class="k">do</span>

  <span class="n">describe</span> <span class="s1">'#summary'</span> <span class="k">do</span>

    <span class="n">context</span> <span class="s1">'when there is a summary'</span> <span class="k">do</span>

      <span class="n">it</span> <span class="s1">'returns the summary'</span> <span class="k">do</span>
        <span class="c1"># ...</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="c1"># good</span>
<span class="n">describe</span> <span class="no">Article</span> <span class="k">do</span>
  <span class="n">describe</span> <span class="s1">'#summary'</span> <span class="k">do</span>
    <span class="n">context</span> <span class="s1">'when there is a summary'</span> <span class="k">do</span>
      <span class="n">it</span> <span class="s1">'returns the summary'</span> <span class="k">do</span>
        <span class="c1"># ...</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="empty-lines-between-describes"><a class="anchor" href="#empty-lines-between-describes"></a><a class="link" href="#empty-lines-between-describes">Empty Line between Example Groups</a></h3>
<div class="paragraph">
<p>Leave one empty line between <code>feature</code>, <code>context</code> or <code>describe</code> blocks.
Do not leave empty line after the last such block in a group.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="ruby"><span class="c1"># bad</span>
<span class="n">describe</span> <span class="no">Article</span> <span class="k">do</span>
  <span class="n">describe</span> <span class="s1">'#summary'</span> <span class="k">do</span>
    <span class="n">context</span> <span class="s1">'when there is a summary'</span> <span class="k">do</span>
      <span class="c1"># ...</span>
    <span class="k">end</span>
    <span class="n">context</span> <span class="s1">'when there is no summary'</span> <span class="k">do</span>
      <span class="c1"># ...</span>
    <span class="k">end</span>

  <span class="k">end</span>
  <span class="n">describe</span> <span class="s1">'#comments'</span> <span class="k">do</span>
    <span class="c1"># ...</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="c1"># good</span>
<span class="n">describe</span> <span class="no">Article</span> <span class="k">do</span>
  <span class="n">describe</span> <span class="s1">'#summary'</span> <span class="k">do</span>
    <span class="n">context</span> <span class="s1">'when there is a summary'</span> <span class="k">do</span>
      <span class="c1"># ...</span>
    <span class="k">end</span>

    <span class="n">context</span> <span class="s1">'when there is no summary'</span> <span class="k">do</span>
      <span class="c1"># ...</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="n">describe</span> <span class="s1">'#comments'</span> <span class="k">do</span>
    <span class="c1"># ...</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="empty-line-after-let"><a class="anchor" href="#empty-line-after-let"></a><a class="link" href="#empty-line-after-let">Empty Line After <code>let</code><a id="empty-lines-after-let"></a></a></h3>
<div class="paragraph">
<p>Leave one empty line after <code>let</code>, <code>subject</code>, and <code>before</code>/<code>after</code> blocks.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="ruby"><span class="c1"># bad</span>
<span class="n">describe</span> <span class="no">Article</span> <span class="k">do</span>
  <span class="n">subject</span> <span class="p">{</span> <span class="no">FactoryBot</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="ss">:some_article</span><span class="p">)</span> <span class="p">}</span>
  <span class="n">describe</span> <span class="s1">'#summary'</span> <span class="k">do</span>
    <span class="c1"># ...</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="c1"># good</span>
<span class="n">describe</span> <span class="no">Article</span> <span class="k">do</span>
  <span class="n">subject</span> <span class="p">{</span> <span class="no">FactoryBot</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="ss">:some_article</span><span class="p">)</span> <span class="p">}</span>

  <span class="n">describe</span> <span class="s1">'#summary'</span> <span class="k">do</span>
    <span class="c1"># ...</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="let-grouping"><a class="anchor" href="#let-grouping"></a><a class="link" href="#let-grouping">Let Grouping</a></h3>
<div class="paragraph">
<p>Only group <code>let</code>, <code>subject</code> blocks and separate them from <code>before</code>/<code>after</code> blocks.
It makes the code much more readable.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="ruby"><span class="c1"># bad</span>
<span class="n">describe</span> <span class="no">Article</span> <span class="k">do</span>
  <span class="n">subject</span> <span class="p">{</span> <span class="no">FactoryBot</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="ss">:some_article</span><span class="p">)</span> <span class="p">}</span>
  <span class="n">let</span><span class="p">(</span><span class="ss">:user</span><span class="p">)</span> <span class="p">{</span> <span class="no">FactoryBot</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="ss">:user</span><span class="p">)</span> <span class="p">}</span>
  <span class="n">before</span> <span class="k">do</span>
    <span class="c1"># ...</span>
  <span class="k">end</span>
  <span class="n">after</span> <span class="k">do</span>
    <span class="c1"># ...</span>
  <span class="k">end</span>
  <span class="n">describe</span> <span class="s1">'#summary'</span> <span class="k">do</span>
    <span class="c1"># ...</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="c1"># good</span>
<span class="n">describe</span> <span class="no">Article</span> <span class="k">do</span>
  <span class="n">subject</span> <span class="p">{</span> <span class="no">FactoryBot</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="ss">:some_article</span><span class="p">)</span> <span class="p">}</span>
  <span class="n">let</span><span class="p">(</span><span class="ss">:user</span><span class="p">)</span> <span class="p">{</span> <span class="no">FactoryBot</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="ss">:user</span><span class="p">)</span> <span class="p">}</span>

  <span class="n">before</span> <span class="k">do</span>
    <span class="c1"># ...</span>
  <span class="k">end</span>

  <span class="n">after</span> <span class="k">do</span>
    <span class="c1"># ...</span>
  <span class="k">end</span>

  <span class="n">describe</span> <span class="s1">'#summary'</span> <span class="k">do</span>
    <span class="c1"># ...</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="empty-lines-around-examples"><a class="anchor" href="#empty-lines-around-examples"></a><a class="link" href="#empty-lines-around-examples">Empty Lines around Examples<a id="empty-lines-around-it"></a></a></h3>
<div class="paragraph">
<p>Leave one empty line around <code>it</code>/<code>specify</code> blocks. This helps to separate the expectations from their conditional logic (contexts for instance).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="ruby"><span class="c1"># bad</span>
<span class="n">describe</span> <span class="s1">'#summary'</span> <span class="k">do</span>
  <span class="n">let</span><span class="p">(</span><span class="ss">:item</span><span class="p">)</span> <span class="p">{</span> <span class="n">double</span><span class="p">(</span><span class="s1">'something'</span><span class="p">)</span> <span class="p">}</span>

  <span class="n">it</span> <span class="s1">'returns the summary'</span> <span class="k">do</span>
    <span class="c1"># ...</span>
  <span class="k">end</span>
  <span class="n">it</span> <span class="s1">'does something else'</span> <span class="k">do</span>
    <span class="c1"># ...</span>
  <span class="k">end</span>
  <span class="n">it</span> <span class="s1">'does another thing'</span> <span class="k">do</span>
    <span class="c1"># ...</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="c1"># good</span>
<span class="n">describe</span> <span class="s1">'#summary'</span> <span class="k">do</span>
  <span class="n">let</span><span class="p">(</span><span class="ss">:item</span><span class="p">)</span> <span class="p">{</span> <span class="n">double</span><span class="p">(</span><span class="s1">'something'</span><span class="p">)</span> <span class="p">}</span>

  <span class="n">it</span> <span class="s1">'returns the summary'</span> <span class="k">do</span>
    <span class="c1"># ...</span>
  <span class="k">end</span>

  <span class="n">it</span> <span class="s1">'does something else'</span> <span class="k">do</span>
    <span class="c1"># ...</span>
  <span class="k">end</span>

  <span class="n">it</span> <span class="s1">'does another thing'</span> <span class="k">do</span>
    <span class="c1"># ...</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="leading-subject"><a class="anchor" href="#leading-subject"></a><a class="link" href="#leading-subject">Leading <code>subject</code></a></h3>
<div class="paragraph">
<p>When <code>subject</code> is used, it should be the first declaration in the example group.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="ruby"><span class="c1"># bad</span>
<span class="n">describe</span> <span class="no">Article</span> <span class="k">do</span>
  <span class="n">before</span> <span class="k">do</span>
    <span class="c1"># ...</span>
  <span class="k">end</span>

  <span class="n">let</span><span class="p">(</span><span class="ss">:user</span><span class="p">)</span> <span class="p">{</span> <span class="no">FactoryBot</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="ss">:user</span><span class="p">)</span> <span class="p">}</span>
  <span class="n">subject</span> <span class="p">{</span> <span class="no">FactoryBot</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="ss">:some_article</span><span class="p">)</span> <span class="p">}</span>

  <span class="n">describe</span> <span class="s1">'#summary'</span> <span class="k">do</span>
    <span class="c1"># ...</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="c1"># good</span>
<span class="n">describe</span> <span class="no">Article</span> <span class="k">do</span>
  <span class="n">subject</span> <span class="p">{</span> <span class="no">FactoryBot</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="ss">:some_article</span><span class="p">)</span> <span class="p">}</span>
  <span class="n">let</span><span class="p">(</span><span class="ss">:user</span><span class="p">)</span> <span class="p">{</span> <span class="no">FactoryBot</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="ss">:user</span><span class="p">)</span> <span class="p">}</span>

  <span class="n">before</span> <span class="k">do</span>
    <span class="c1"># ...</span>
  <span class="k">end</span>

  <span class="n">describe</span> <span class="s1">'#summary'</span> <span class="k">do</span>
    <span class="c1"># ...</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="example-group-structure"><a class="anchor" href="#example-group-structure"></a><a class="link" href="#example-group-structure">Example Group Structure</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="use-contexts"><a class="anchor" href="#use-contexts"></a><a class="link" href="#use-contexts">Use Contexts</a></h3>
<div class="paragraph">
<p>Use contexts to make the tests clear, well organized, and easy to read.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="ruby"><span class="c1"># bad</span>
<span class="n">it</span> <span class="s1">'has 200 status code if logged in'</span> <span class="k">do</span>
  <span class="n">expect</span><span class="p">(</span><span class="n">response</span><span class="p">).</span><span class="nf">to</span> <span class="n">respond_with</span> <span class="mi">200</span>
<span class="k">end</span>

<span class="n">it</span> <span class="s1">'has 401 status code if not logged in'</span> <span class="k">do</span>
  <span class="n">expect</span><span class="p">(</span><span class="n">response</span><span class="p">).</span><span class="nf">to</span> <span class="n">respond_with</span> <span class="mi">401</span>
<span class="k">end</span>

<span class="c1"># good</span>
<span class="n">context</span> <span class="s1">'when logged in'</span> <span class="k">do</span>
  <span class="n">it</span> <span class="p">{</span> <span class="n">is_expected</span><span class="p">.</span><span class="nf">to</span> <span class="n">respond_with</span> <span class="mi">200</span> <span class="p">}</span>
<span class="k">end</span>

<span class="n">context</span> <span class="s1">'when logged out'</span> <span class="k">do</span>
  <span class="n">it</span> <span class="p">{</span> <span class="n">is_expected</span><span class="p">.</span><span class="nf">to</span> <span class="n">respond_with</span> <span class="mi">401</span> <span class="p">}</span>
<span class="k">end</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="context-cases"><a class="anchor" href="#context-cases"></a><a class="link" href="#context-cases">Context Cases</a></h3>
<div class="paragraph">
<p><code>context</code> blocks should pretty much always have an opposite negative case.
It is a code smell if there is a single context (without a matching negative case), and this code needs refactoring, or may have no purpose.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="ruby"><span class="c1"># bad - needs refactoring</span>
<span class="n">describe</span> <span class="s1">'#attributes'</span> <span class="k">do</span>
  <span class="n">context</span> <span class="s1">'the returned hash'</span> <span class="k">do</span>
    <span class="n">it</span> <span class="s1">'includes the display name'</span> <span class="k">do</span>
      <span class="c1"># ...</span>
    <span class="k">end</span>

    <span class="n">it</span> <span class="s1">'includes the creation time'</span> <span class="k">do</span>
      <span class="c1"># ...</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="c1"># bad - the negative case needs to be tested, but isn't</span>
<span class="n">describe</span> <span class="s1">'#attributes'</span> <span class="k">do</span>
  <span class="n">context</span> <span class="s1">'when display name is present'</span> <span class="k">do</span>
    <span class="n">before</span> <span class="k">do</span>
      <span class="n">article</span><span class="p">.</span><span class="nf">display_name</span> <span class="o">=</span> <span class="s1">'something'</span>
    <span class="k">end</span>

    <span class="n">it</span> <span class="s1">'includes the display name'</span> <span class="k">do</span>
      <span class="c1"># ...</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="c1"># good</span>
<span class="n">describe</span> <span class="s1">'#attributes'</span> <span class="k">do</span>
  <span class="n">let</span><span class="p">(</span><span class="ss">:article</span><span class="p">)</span> <span class="p">{</span> <span class="no">FactoryBot</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="ss">:article</span><span class="p">)</span> <span class="p">}</span>
  <span class="n">subject</span><span class="p">(</span><span class="ss">:attributes</span><span class="p">)</span> <span class="p">{</span> <span class="n">article</span><span class="p">.</span><span class="nf">attributes</span> <span class="p">}</span>

  <span class="n">context</span> <span class="s1">'when display name is present'</span> <span class="k">do</span>
    <span class="n">before</span> <span class="k">do</span>
      <span class="n">article</span><span class="p">.</span><span class="nf">display_name</span> <span class="o">=</span> <span class="s1">'something'</span>
    <span class="k">end</span>

    <span class="n">it</span> <span class="p">{</span> <span class="n">is_expected</span><span class="p">.</span><span class="nf">to</span> <span class="kp">include</span><span class="p">(</span><span class="ss">display_name: </span><span class="n">article</span><span class="p">.</span><span class="nf">display_name</span><span class="p">)</span> <span class="p">}</span>
  <span class="k">end</span>

  <span class="n">context</span> <span class="s1">'when display name is not present'</span> <span class="k">do</span>
    <span class="n">before</span> <span class="k">do</span>
      <span class="n">article</span><span class="p">.</span><span class="nf">display_name</span> <span class="o">=</span> <span class="kp">nil</span>
    <span class="k">end</span>

    <span class="n">it</span> <span class="p">{</span> <span class="n">is_expected</span><span class="p">.</span><span class="nf">not_to</span> <span class="kp">include</span><span class="p">(</span><span class="ss">:display_name</span><span class="p">)</span> <span class="p">}</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="let-blocks"><a class="anchor" href="#let-blocks"></a><a class="link" href="#let-blocks"><code>let</code> Blocks</a></h3>
<div class="paragraph">
<p>Use <code>let</code> and <code>let!</code> for data that is used across several examples in an example group.
Use <code>let!</code> to define variables even if they are not referenced in some of the examples, e.g. when testing balancing negative cases.
Do not overuse <code>let</code>s for primitive data, find the balance between frequency of use and complexity of the definition.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="ruby"><span class="c1"># bad</span>
<span class="n">it</span> <span class="s1">'finds shortest path'</span> <span class="k">do</span>
  <span class="n">tree</span> <span class="o">=</span> <span class="no">Tree</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">1</span> <span class="o">=&gt;</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span> <span class="o">=&gt;</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span> <span class="o">=&gt;</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">3</span> <span class="o">=&gt;</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span> <span class="o">=&gt;</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span> <span class="o">=&gt;</span> <span class="mi">6</span><span class="p">)</span>
  <span class="n">expect</span><span class="p">(</span><span class="n">dijkstra</span><span class="p">.</span><span class="nf">shortest_path</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="ss">from: </span><span class="mi">1</span><span class="p">,</span> <span class="ss">to: </span><span class="mi">6</span><span class="p">)).</span><span class="nf">to</span> <span class="n">eq</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">])</span>
<span class="k">end</span>

<span class="n">it</span> <span class="s1">'finds longest path'</span> <span class="k">do</span>
  <span class="n">tree</span> <span class="o">=</span> <span class="no">Tree</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">1</span> <span class="o">=&gt;</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span> <span class="o">=&gt;</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span> <span class="o">=&gt;</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">3</span> <span class="o">=&gt;</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span> <span class="o">=&gt;</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span> <span class="o">=&gt;</span> <span class="mi">6</span><span class="p">)</span>
  <span class="n">expect</span><span class="p">(</span><span class="n">dijkstra</span><span class="p">.</span><span class="nf">longest_path</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="ss">from: </span><span class="mi">1</span><span class="p">,</span> <span class="ss">to: </span><span class="mi">6</span><span class="p">)).</span><span class="nf">to</span> <span class="n">eq</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">])</span>
<span class="k">end</span>

<span class="c1"># good</span>
<span class="n">let</span><span class="p">(</span><span class="ss">:tree</span><span class="p">)</span> <span class="p">{</span> <span class="no">Tree</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">1</span> <span class="o">=&gt;</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span> <span class="o">=&gt;</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span> <span class="o">=&gt;</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">3</span> <span class="o">=&gt;</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span> <span class="o">=&gt;</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span> <span class="o">=&gt;</span> <span class="mi">6</span><span class="p">)</span> <span class="p">}</span>

<span class="n">it</span> <span class="s1">'finds shortest path'</span> <span class="k">do</span>
  <span class="n">expect</span><span class="p">(</span><span class="n">dijkstra</span><span class="p">.</span><span class="nf">shortest_path</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="ss">from: </span><span class="mi">1</span><span class="p">,</span> <span class="ss">to: </span><span class="mi">6</span><span class="p">)).</span><span class="nf">to</span> <span class="n">eq</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">])</span>
<span class="k">end</span>

<span class="n">it</span> <span class="s1">'finds longest path'</span> <span class="k">do</span>
  <span class="n">expect</span><span class="p">(</span><span class="n">dijkstra</span><span class="p">.</span><span class="nf">longest_path</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="ss">from: </span><span class="mi">1</span><span class="p">,</span> <span class="ss">to: </span><span class="mi">6</span><span class="p">)).</span><span class="nf">to</span> <span class="n">eq</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">])</span>
<span class="k">end</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="instance-variables"><a class="anchor" href="#instance-variables"></a><a class="link" href="#instance-variables">Instance Variables</a></h3>
<div class="paragraph">
<p>Use <code>let</code> definitions instead of instance variables.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="ruby"><span class="c1"># bad</span>
<span class="n">before</span> <span class="p">{</span> <span class="vi">@name</span> <span class="o">=</span> <span class="s1">'John Wayne'</span> <span class="p">}</span>

<span class="n">it</span> <span class="s1">'reverses a name'</span> <span class="k">do</span>
  <span class="n">expect</span><span class="p">(</span><span class="n">reverser</span><span class="p">.</span><span class="nf">reverse</span><span class="p">(</span><span class="vi">@name</span><span class="p">)).</span><span class="nf">to</span> <span class="n">eq</span><span class="p">(</span><span class="s1">'enyaW nhoJ'</span><span class="p">)</span>
<span class="k">end</span>

<span class="c1"># good</span>
<span class="n">let</span><span class="p">(</span><span class="ss">:name</span><span class="p">)</span> <span class="p">{</span> <span class="s1">'John Wayne'</span> <span class="p">}</span>

<span class="n">it</span> <span class="s1">'reverses a name'</span> <span class="k">do</span>
  <span class="n">expect</span><span class="p">(</span><span class="n">reverser</span><span class="p">.</span><span class="nf">reverse</span><span class="p">(</span><span class="nb">name</span><span class="p">)).</span><span class="nf">to</span> <span class="n">eq</span><span class="p">(</span><span class="s1">'enyaW nhoJ'</span><span class="p">)</span>
<span class="k">end</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="shared-examples"><a class="anchor" href="#shared-examples"></a><a class="link" href="#shared-examples">Shared Examples</a></h3>
<div class="paragraph">
<p>Use shared examples to reduce code duplication.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="ruby"><span class="c1"># bad</span>
<span class="n">describe</span> <span class="s1">'GET /articles'</span> <span class="k">do</span>
  <span class="n">let</span><span class="p">(</span><span class="ss">:article</span><span class="p">)</span> <span class="p">{</span> <span class="no">FactoryBot</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="ss">:article</span><span class="p">,</span> <span class="ss">owner: </span><span class="n">owner</span><span class="p">)</span> <span class="p">}</span>

  <span class="n">before</span> <span class="p">{</span> <span class="n">page</span><span class="p">.</span><span class="nf">driver</span><span class="p">.</span><span class="nf">get</span> <span class="s1">'/articles'</span> <span class="p">}</span>

  <span class="n">context</span> <span class="s1">'when user is the owner'</span> <span class="k">do</span>
    <span class="n">let</span><span class="p">(</span><span class="ss">:user</span><span class="p">)</span> <span class="p">{</span> <span class="n">owner</span> <span class="p">}</span>

    <span class="n">it</span> <span class="s1">'shows all owned articles'</span> <span class="k">do</span>
      <span class="n">expect</span><span class="p">(</span><span class="n">page</span><span class="p">.</span><span class="nf">status_code</span><span class="p">).</span><span class="nf">to</span> <span class="n">be</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>
      <span class="n">contains_resource</span> <span class="n">resource</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="n">context</span> <span class="s1">'when user is an admin'</span> <span class="k">do</span>
    <span class="n">let</span><span class="p">(</span><span class="ss">:user</span><span class="p">)</span> <span class="p">{</span> <span class="no">FactoryBot</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="ss">:user</span><span class="p">,</span> <span class="ss">:admin</span><span class="p">)</span> <span class="p">}</span>

    <span class="n">it</span> <span class="s1">'shows all resources'</span> <span class="k">do</span>
      <span class="n">expect</span><span class="p">(</span><span class="n">page</span><span class="p">.</span><span class="nf">status_code</span><span class="p">).</span><span class="nf">to</span> <span class="n">be</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>
      <span class="n">contains_resource</span> <span class="n">resource</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="c1"># good</span>
<span class="n">describe</span> <span class="s1">'GET /articles'</span> <span class="k">do</span>
  <span class="n">let</span><span class="p">(</span><span class="ss">:article</span><span class="p">)</span> <span class="p">{</span> <span class="no">FactoryBot</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="ss">:article</span><span class="p">,</span> <span class="ss">owner: </span><span class="n">owner</span><span class="p">)</span> <span class="p">}</span>

  <span class="n">before</span> <span class="p">{</span> <span class="n">page</span><span class="p">.</span><span class="nf">driver</span><span class="p">.</span><span class="nf">get</span> <span class="s1">'/articles'</span> <span class="p">}</span>

  <span class="n">shared_examples</span> <span class="s1">'shows articles'</span> <span class="k">do</span>
    <span class="n">it</span> <span class="s1">'shows all related articles'</span> <span class="k">do</span>
      <span class="n">expect</span><span class="p">(</span><span class="n">page</span><span class="p">.</span><span class="nf">status_code</span><span class="p">).</span><span class="nf">to</span> <span class="n">be</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>
      <span class="n">contains_resource</span> <span class="n">resource</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="n">context</span> <span class="s1">'when user is the owner'</span> <span class="k">do</span>
    <span class="n">let</span><span class="p">(</span><span class="ss">:user</span><span class="p">)</span> <span class="p">{</span> <span class="n">owner</span> <span class="p">}</span>

    <span class="n">include_examples</span> <span class="s1">'shows articles'</span>
  <span class="k">end</span>

  <span class="n">context</span> <span class="s1">'when user is an admin'</span> <span class="k">do</span>
    <span class="n">let</span><span class="p">(</span><span class="ss">:user</span><span class="p">)</span> <span class="p">{</span> <span class="no">FactoryBot</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="ss">:user</span><span class="p">,</span> <span class="ss">:admin</span><span class="p">)</span> <span class="p">}</span>

    <span class="n">include_examples</span> <span class="s1">'shows articles'</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="c1"># good</span>
<span class="n">describe</span> <span class="s1">'GET /devices'</span> <span class="k">do</span>
  <span class="n">let</span><span class="p">(</span><span class="ss">:resource</span><span class="p">)</span> <span class="p">{</span> <span class="no">FactoryBot</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="ss">:device</span><span class="p">,</span> <span class="ss">created_from: </span><span class="n">user</span><span class="p">)</span> <span class="p">}</span>

  <span class="n">it_behaves_like</span> <span class="s1">'a listable resource'</span>
  <span class="n">it_behaves_like</span> <span class="s1">'a paginable resource'</span>
  <span class="n">it_behaves_like</span> <span class="s1">'a searchable resource'</span>
  <span class="n">it_behaves_like</span> <span class="s1">'a filterable list'</span>
<span class="k">end</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="redundant-beforeeach"><a class="anchor" href="#redundant-beforeeach"></a><a class="link" href="#redundant-beforeeach">Redundant <code>before(:each)</code></a></h3>
<div class="paragraph">
<p>Don&#8217;t specify <code>:each</code>/<code>:example</code> scope for <code>before</code>/<code>after</code>/<code>around</code> blocks, as it is the default.
Prefer <code>:example</code> when explicitly indicating the scope.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="ruby"><span class="c1"># bad</span>
<span class="n">describe</span> <span class="s1">'#summary'</span> <span class="k">do</span>
  <span class="n">before</span><span class="p">(</span><span class="ss">:example</span><span class="p">)</span> <span class="k">do</span>
    <span class="c1"># ...</span>
  <span class="k">end</span>

  <span class="c1"># ...</span>
<span class="k">end</span>

<span class="c1"># good</span>
<span class="n">describe</span> <span class="s1">'#summary'</span> <span class="k">do</span>
  <span class="n">before</span> <span class="k">do</span>
    <span class="c1"># ...</span>
  <span class="k">end</span>

  <span class="c1"># ...</span>
<span class="k">end</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ambiguous-hook-scope"><a class="anchor" href="#ambiguous-hook-scope"></a><a class="link" href="#ambiguous-hook-scope">Ambiguous Hook Scope</a></h3>
<div class="paragraph">
<p>Use <code>:context</code> instead of the ambiguous <code>:all</code> scope in <code>before</code>/<code>after</code> hooks.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="ruby"><span class="c1"># bad</span>
<span class="n">describe</span> <span class="s1">'#summary'</span> <span class="k">do</span>
  <span class="n">before</span><span class="p">(</span><span class="ss">:all</span><span class="p">)</span> <span class="k">do</span>
    <span class="c1"># ...</span>
  <span class="k">end</span>

  <span class="c1"># ...</span>
<span class="k">end</span>

<span class="c1"># good</span>
<span class="n">describe</span> <span class="s1">'#summary'</span> <span class="k">do</span>
  <span class="n">before</span><span class="p">(</span><span class="ss">:context</span><span class="p">)</span> <span class="k">do</span>
    <span class="c1"># ...</span>
  <span class="k">end</span>

  <span class="c1"># ...</span>
<span class="k">end</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="avoid-hooks-with-context-scope"><a class="anchor" href="#avoid-hooks-with-context-scope"></a><a class="link" href="#avoid-hooks-with-context-scope">Avoid Hooks with <code>:context</code> Scope</a></h3>
<div class="paragraph">
<p>Avoid using <code>before</code>/<code>after</code> with <code>:context</code> scope.
Beware of the state leakage between the examples.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="example-structure"><a class="anchor" href="#example-structure"></a><a class="link" href="#example-structure">Example Structure</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="expectation-per-example"><a class="anchor" href="#expectation-per-example"></a><a class="link" href="#expectation-per-example">Expectation per Example<a id="one-expectation"></a></a></h3>
<div class="paragraph">
<p>For examples two styles are considered acceptable.
The first variant is separate example for each expectation, which comes with a cost of repeated context initialization.
The second variant is multiple expectations per example with <code>aggregate_failures</code> tag set for a group or example.
Use your best judgement in each case, and apply your strategy consistently.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="ruby"><span class="c1"># good - one expectation per example</span>
<span class="n">describe</span> <span class="no">ArticlesController</span> <span class="k">do</span>
  <span class="c1">#...</span>

  <span class="n">describe</span> <span class="s1">'GET new'</span> <span class="k">do</span>
    <span class="n">it</span> <span class="s1">'assigns a new article'</span> <span class="k">do</span>
      <span class="n">get</span> <span class="ss">:new</span>
      <span class="n">expect</span><span class="p">(</span><span class="n">assigns</span><span class="p">[</span><span class="ss">:article</span><span class="p">]).</span><span class="nf">to</span> <span class="n">be_a</span><span class="p">(</span><span class="no">Article</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="n">it</span> <span class="s1">'renders the new article template'</span> <span class="k">do</span>
      <span class="n">get</span> <span class="ss">:new</span>
      <span class="n">expect</span><span class="p">(</span><span class="n">response</span><span class="p">).</span><span class="nf">to</span> <span class="n">render_template</span> <span class="ss">:new</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="c1"># good - multiple expectations with aggregated failures</span>
<span class="n">describe</span> <span class="no">ArticlesController</span> <span class="k">do</span>
  <span class="c1">#...</span>

  <span class="n">describe</span> <span class="s1">'GET new'</span><span class="p">,</span> <span class="ss">:aggregate_failures</span> <span class="k">do</span>
    <span class="n">it</span> <span class="s1">'assigns new article and renders the new article template'</span> <span class="k">do</span>
      <span class="n">get</span> <span class="ss">:new</span>
      <span class="n">expect</span><span class="p">(</span><span class="n">assigns</span><span class="p">[</span><span class="ss">:article</span><span class="p">]).</span><span class="nf">to</span> <span class="n">be_a</span><span class="p">(</span><span class="no">Article</span><span class="p">)</span>
      <span class="n">expect</span><span class="p">(</span><span class="n">response</span><span class="p">).</span><span class="nf">to</span> <span class="n">render_template</span> <span class="ss">:new</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="c1"># ...</span>
<span class="k">end</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="subject"><a class="anchor" href="#subject"></a><a class="link" href="#subject">Subject</a></h3>
<div class="paragraph">
<p>When several tests relate to the same subject, use <code>subject</code> to reduce repetition.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="ruby"><span class="c1"># bad</span>
<span class="n">it</span> <span class="p">{</span> <span class="n">expect</span><span class="p">(</span><span class="n">hero</span><span class="p">.</span><span class="nf">equipment</span><span class="p">).</span><span class="nf">to</span> <span class="n">be_heavy</span> <span class="p">}</span>
<span class="n">it</span> <span class="p">{</span> <span class="n">expect</span><span class="p">(</span><span class="n">hero</span><span class="p">.</span><span class="nf">equipment</span><span class="p">).</span><span class="nf">to</span> <span class="kp">include</span> <span class="s1">'sword'</span> <span class="p">}</span>

<span class="c1"># good</span>
<span class="n">subject</span><span class="p">(</span><span class="ss">:equipment</span><span class="p">)</span> <span class="p">{</span> <span class="n">hero</span><span class="p">.</span><span class="nf">equipment</span> <span class="p">}</span>

<span class="n">it</span> <span class="p">{</span> <span class="n">expect</span><span class="p">(</span><span class="n">equipment</span><span class="p">).</span><span class="nf">to</span> <span class="n">be_heavy</span> <span class="p">}</span>
<span class="n">it</span> <span class="p">{</span> <span class="n">expect</span><span class="p">(</span><span class="n">equipment</span><span class="p">).</span><span class="nf">to</span> <span class="kp">include</span> <span class="s1">'sword'</span> <span class="p">}</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="use-subject"><a class="anchor" href="#use-subject"></a><a class="link" href="#use-subject">Named Subject</a></h3>
<div class="paragraph">
<p>Use named <code>subject</code> when possible.
Only use anonymous subject declaration when you don&#8217;t reference it in any tests, e.g. when <code>is_expected</code> is used.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="ruby"><span class="c1"># bad</span>
<span class="n">describe</span> <span class="no">Article</span> <span class="k">do</span>
  <span class="n">subject</span> <span class="p">{</span> <span class="no">FactoryBot</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="ss">:article</span><span class="p">)</span> <span class="p">}</span>

  <span class="n">it</span> <span class="s1">'is not published on creation'</span> <span class="k">do</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">subject</span><span class="p">).</span><span class="nf">not_to</span> <span class="n">be_published</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="c1"># good</span>
<span class="n">describe</span> <span class="no">Article</span> <span class="k">do</span>
  <span class="n">subject</span> <span class="p">{</span> <span class="no">FactoryBot</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="ss">:article</span><span class="p">)</span> <span class="p">}</span>

  <span class="n">it</span> <span class="s1">'is not published on creation'</span> <span class="k">do</span>
    <span class="n">is_expected</span><span class="p">.</span><span class="nf">not_to</span> <span class="n">be_published</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="c1"># even better</span>
<span class="n">describe</span> <span class="no">Article</span> <span class="k">do</span>
  <span class="n">subject</span><span class="p">(</span><span class="ss">:article</span><span class="p">)</span> <span class="p">{</span> <span class="no">FactoryBot</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="ss">:article</span><span class="p">)</span> <span class="p">}</span>

  <span class="n">it</span> <span class="s1">'is not published on creation'</span> <span class="k">do</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">article</span><span class="p">).</span><span class="nf">not_to</span> <span class="n">be_published</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="subject-naming-in-context"><a class="anchor" href="#subject-naming-in-context"></a><a class="link" href="#subject-naming-in-context">Subject Naming in Context</a></h3>
<div class="paragraph">
<p>When you reassign subject with different attributes in different contexts, give different names to the subject, so it&#8217;s easier to see what the actual subject represents.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="ruby"><span class="c1"># bad</span>
<span class="n">describe</span> <span class="no">Article</span> <span class="k">do</span>
  <span class="n">context</span> <span class="s1">'when there is an author'</span> <span class="k">do</span>
    <span class="n">subject</span><span class="p">(</span><span class="ss">:article</span><span class="p">)</span> <span class="p">{</span> <span class="no">FactoryBot</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="ss">:article</span><span class="p">,</span> <span class="ss">author: </span><span class="n">user</span><span class="p">)</span> <span class="p">}</span>

    <span class="n">it</span> <span class="s1">'shows other articles by the same author'</span> <span class="k">do</span>
      <span class="n">expect</span><span class="p">(</span><span class="n">article</span><span class="p">.</span><span class="nf">related_stories</span><span class="p">).</span><span class="nf">to</span> <span class="kp">include</span><span class="p">(</span><span class="n">story1</span><span class="p">,</span> <span class="n">story2</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="n">context</span> <span class="s1">'when the author is anonymous'</span> <span class="k">do</span>
    <span class="n">subject</span><span class="p">(</span><span class="ss">:article</span><span class="p">)</span> <span class="p">{</span> <span class="no">FactoryBot</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="ss">:article</span><span class="p">,</span> <span class="ss">author: </span><span class="kp">nil</span><span class="p">)</span> <span class="p">}</span>

    <span class="n">it</span> <span class="s1">'matches stories by title'</span> <span class="k">do</span>
      <span class="n">expect</span><span class="p">(</span><span class="n">article</span><span class="p">.</span><span class="nf">related_stories</span><span class="p">).</span><span class="nf">to</span> <span class="kp">include</span><span class="p">(</span><span class="n">story3</span><span class="p">,</span> <span class="n">story4</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="c1"># good</span>
<span class="n">describe</span> <span class="no">Article</span> <span class="k">do</span>
  <span class="n">context</span> <span class="s1">'when article has an author'</span> <span class="k">do</span>
    <span class="n">subject</span><span class="p">(</span><span class="ss">:article</span><span class="p">)</span> <span class="p">{</span> <span class="no">FactoryBot</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="ss">:article</span><span class="p">,</span> <span class="ss">author: </span><span class="n">user</span><span class="p">)</span> <span class="p">}</span>

    <span class="n">it</span> <span class="s1">'shows other articles by the same author'</span> <span class="k">do</span>
      <span class="n">expect</span><span class="p">(</span><span class="n">article</span><span class="p">.</span><span class="nf">related_stories</span><span class="p">).</span><span class="nf">to</span> <span class="kp">include</span><span class="p">(</span><span class="n">story1</span><span class="p">,</span> <span class="n">story2</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="n">context</span> <span class="s1">'when the author is anonymous'</span> <span class="k">do</span>
    <span class="n">subject</span><span class="p">(</span><span class="ss">:guest_article</span><span class="p">)</span> <span class="p">{</span> <span class="no">FactoryBot</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="ss">:article</span><span class="p">,</span> <span class="ss">author: </span><span class="kp">nil</span><span class="p">)</span> <span class="p">}</span>

    <span class="n">it</span> <span class="s1">'matches stories by title'</span> <span class="k">do</span>
      <span class="n">expect</span><span class="p">(</span><span class="n">guest_article</span><span class="p">.</span><span class="nf">related_stories</span><span class="p">).</span><span class="nf">to</span> <span class="kp">include</span><span class="p">(</span><span class="n">story3</span><span class="p">,</span> <span class="n">story4</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="dont-stub-subject"><a class="anchor" href="#dont-stub-subject"></a><a class="link" href="#dont-stub-subject">Don&#8217;t Stub Subject</a></h3>
<div class="paragraph">
<p>Don&#8217;t stub methods of the object under test, it&#8217;s a code smell and often indicates a bad design of the object itself.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="ruby"><span class="c1"># bad</span>
<span class="n">describe</span> <span class="s1">'Article'</span> <span class="k">do</span>
  <span class="n">subject</span><span class="p">(</span><span class="ss">:article</span><span class="p">)</span> <span class="p">{</span> <span class="no">Article</span><span class="p">.</span><span class="nf">new</span> <span class="p">}</span>

  <span class="n">it</span> <span class="s1">'indicates that the author is unknown'</span> <span class="k">do</span>
    <span class="n">allow</span><span class="p">(</span><span class="n">article</span><span class="p">).</span><span class="nf">to</span> <span class="n">receive</span><span class="p">(</span><span class="ss">:author</span><span class="p">).</span><span class="nf">and_return</span><span class="p">(</span><span class="kp">nil</span><span class="p">)</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">article</span><span class="p">.</span><span class="nf">description</span><span class="p">).</span><span class="nf">to</span> <span class="kp">include</span><span class="p">(</span><span class="s1">'by an unknown author'</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="c1"># good - with correct subject initialization</span>
<span class="n">describe</span> <span class="s1">'Article'</span> <span class="k">do</span>
  <span class="n">subject</span><span class="p">(</span><span class="ss">:article</span><span class="p">)</span> <span class="p">{</span> <span class="no">Article</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="ss">author: </span><span class="kp">nil</span><span class="p">)</span> <span class="p">}</span>

  <span class="n">it</span> <span class="s1">'indicates that the author is unknown'</span> <span class="k">do</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">article</span><span class="p">.</span><span class="nf">description</span><span class="p">).</span><span class="nf">to</span> <span class="kp">include</span><span class="p">(</span><span class="s1">'by an unknown author'</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="c1"># good - with better object design</span>
<span class="n">describe</span> <span class="s1">'Article'</span> <span class="k">do</span>
  <span class="n">subject</span><span class="p">(</span><span class="ss">:presenter</span><span class="p">)</span> <span class="p">{</span> <span class="no">ArticlePresenter</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">article</span><span class="p">)</span> <span class="p">}</span>
  <span class="n">let</span><span class="p">(</span><span class="ss">:article</span><span class="p">)</span> <span class="p">{</span> <span class="no">Article</span><span class="p">.</span><span class="nf">new</span> <span class="p">}</span>

  <span class="n">it</span> <span class="s1">'indicates that the author is unknown'</span> <span class="k">do</span>
    <span class="n">allow</span><span class="p">(</span><span class="n">article</span><span class="p">).</span><span class="nf">to</span> <span class="n">receive</span><span class="p">(</span><span class="ss">:author</span><span class="p">).</span><span class="nf">and_return</span><span class="p">(</span><span class="kp">nil</span><span class="p">)</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">presenter</span><span class="p">.</span><span class="nf">description</span><span class="p">).</span><span class="nf">to</span> <span class="kp">include</span><span class="p">(</span><span class="s1">'by an unknown author'</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="it-and-specify"><a class="anchor" href="#it-and-specify"></a><a class="link" href="#it-and-specify"><code>it</code> and <code>specify</code></a></h3>
<div class="paragraph">
<p>Use <code>specify</code> if the example doesn&#8217;t have a description, use <code>it</code> for examples with descriptions.
An exception is one-line example, where <code>it</code> is preferable.
<code>specify</code> is also useful when the docstring does not read well off of <code>it</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="ruby"><span class="c1"># bad</span>
<span class="n">it</span> <span class="k">do</span>
  <span class="c1"># ...</span>
<span class="k">end</span>

<span class="n">specify</span> <span class="s1">'it sends an email'</span> <span class="k">do</span>
  <span class="c1"># ...</span>
<span class="k">end</span>

<span class="n">specify</span> <span class="p">{</span> <span class="n">is_expected</span><span class="p">.</span><span class="nf">to</span> <span class="n">be_truthy</span> <span class="p">}</span>

<span class="n">it</span> <span class="s1">'#do_something is deprecated'</span> <span class="k">do</span>
  <span class="o">...</span>
<span class="k">end</span>

<span class="c1"># good</span>
<span class="n">specify</span> <span class="k">do</span>
  <span class="c1"># ...</span>
<span class="k">end</span>

<span class="n">it</span> <span class="s1">'sends an email'</span> <span class="k">do</span>
  <span class="c1"># ...</span>
<span class="k">end</span>

<span class="n">it</span> <span class="p">{</span> <span class="n">is_expected</span><span class="p">.</span><span class="nf">to</span> <span class="n">be_truthy</span> <span class="p">}</span>

<span class="n">specify</span> <span class="s1">'#do_something is deprecated'</span> <span class="k">do</span>
  <span class="o">...</span>
<span class="k">end</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="it-in-iterators"><a class="anchor" href="#it-in-iterators"></a><a class="link" href="#it-in-iterators"><code>it</code> in Iterators</a></h3>
<div class="paragraph">
<p>Do not write iterators to generate tests.
When another developer adds a feature to one of the items in the iteration, they must then break it out into a separate test - they are forced to edit code that has nothing to do with their pull request.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="ruby"><span class="c1"># bad</span>
<span class="p">[</span><span class="ss">:new</span><span class="p">,</span> <span class="ss">:show</span><span class="p">,</span> <span class="ss">:index</span><span class="p">].</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">action</span><span class="o">|</span>
  <span class="n">it</span> <span class="s1">'returns 200'</span> <span class="k">do</span>
    <span class="n">get</span> <span class="n">action</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">response</span><span class="p">).</span><span class="nf">to</span> <span class="n">be_ok</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="c1"># good - more verbose, but better for the future development</span>
<span class="n">describe</span> <span class="s1">'GET new'</span> <span class="k">do</span>
  <span class="n">it</span> <span class="s1">'returns 200'</span> <span class="k">do</span>
    <span class="n">get</span> <span class="ss">:new</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">response</span><span class="p">).</span><span class="nf">to</span> <span class="n">be_ok</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="n">describe</span> <span class="s1">'GET show'</span> <span class="k">do</span>
  <span class="n">it</span> <span class="s1">'returns 200'</span> <span class="k">do</span>
    <span class="n">get</span> <span class="ss">:show</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">response</span><span class="p">).</span><span class="nf">to</span> <span class="n">be_ok</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="n">describe</span> <span class="s1">'GET index'</span> <span class="k">do</span>
  <span class="n">it</span> <span class="s1">'returns 200'</span> <span class="k">do</span>
    <span class="n">get</span> <span class="ss">:index</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">response</span><span class="p">).</span><span class="nf">to</span> <span class="n">be_ok</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="incidental-state"><a class="anchor" href="#incidental-state"></a><a class="link" href="#incidental-state">Incidental State</a></h3>
<div class="paragraph">
<p>Avoid incidental state as much as possible.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="ruby"><span class="c1"># bad</span>
<span class="n">it</span> <span class="s1">'publishes the article'</span> <span class="k">do</span>
  <span class="n">article</span><span class="p">.</span><span class="nf">publish</span>

  <span class="c1"># Creating another shared Article test object above would cause this</span>
  <span class="c1"># test to break</span>
  <span class="n">expect</span><span class="p">(</span><span class="no">Article</span><span class="p">.</span><span class="nf">count</span><span class="p">).</span><span class="nf">to</span> <span class="n">eq</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="k">end</span>

<span class="c1"># good</span>
<span class="n">it</span> <span class="s1">'publishes the article'</span> <span class="k">do</span>
  <span class="n">expect</span> <span class="p">{</span> <span class="n">article</span><span class="p">.</span><span class="nf">publish</span> <span class="p">}.</span><span class="nf">to</span> <span class="n">change</span><span class="p">(</span><span class="no">Article</span><span class="p">,</span> <span class="ss">:count</span><span class="p">).</span><span class="nf">by</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="k">end</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="dry"><a class="anchor" href="#dry"></a><a class="link" href="#dry">DRY</a></h3>
<div class="paragraph">
<p>Be careful not to focus on being 'DRY' by moving repeated expectations into a shared environment too early, as this can lead to brittle tests that rely too much on one another.</p>
</div>
<div class="paragraph">
<p>In general, it is best to start with doing everything directly in your <code>it</code> blocks even if it is duplication and then refactor your tests after you have them working to be a little more DRY.
However, keep in mind that duplication in test suites is NOT frowned upon, in fact it is preferred if it provides easier understanding and reading of a test.</p>
</div>
</div>
<div class="sect2">
<h3 id="factories"><a class="anchor" href="#factories"></a><a class="link" href="#factories">Factories</a></h3>
<div class="paragraph">
<p>Use <a href="https://github.com/thoughtbot/factory_bot">Factory Bot</a> to create test data in integration tests.
You should very rarely have to use <code>ModelName.create</code> within an integration spec.
Do <strong>not</strong> use fixtures as they are not nearly as maintainable as factories.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="ruby"><span class="c1"># bad</span>
<span class="n">subject</span><span class="p">(</span><span class="ss">:article</span><span class="p">)</span> <span class="k">do</span>
  <span class="no">Article</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span>
    <span class="ss">title: </span><span class="s1">'Piccolina'</span><span class="p">,</span>
    <span class="ss">author: </span><span class="s1">'John Archer'</span><span class="p">,</span>
    <span class="ss">published_at: </span><span class="s1">'17 August 2172'</span><span class="p">,</span>
    <span class="ss">approved: </span><span class="kp">true</span>
  <span class="p">)</span>
<span class="k">end</span>

<span class="c1"># good</span>
<span class="n">subject</span><span class="p">(</span><span class="ss">:article</span><span class="p">)</span> <span class="p">{</span> <span class="no">FactoryBot</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="ss">:article</span><span class="p">)</span> <span class="p">}</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
When talking about unit tests the best practice would be to use neither fixtures nor factories.
Put as much of your domain logic in libraries that can be tested without needing complex, time consuming setup with either factories or fixtures.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="needed-data"><a class="anchor" href="#needed-data"></a><a class="link" href="#needed-data">Needed Data</a></h3>
<div class="paragraph">
<p>Do not load more data than needed to test your code.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="ruby"><span class="c1"># good</span>
<span class="no">RSpec</span><span class="p">.</span><span class="nf">describe</span> <span class="no">User</span> <span class="k">do</span>
  <span class="n">describe</span> <span class="s2">".top"</span> <span class="k">do</span>
    <span class="n">subject</span> <span class="p">{</span> <span class="n">described_class</span><span class="p">.</span><span class="nf">top</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="p">}</span>

    <span class="n">before</span> <span class="p">{</span> <span class="no">FactoryBot</span><span class="p">.</span><span class="nf">create_list</span><span class="p">(</span><span class="ss">:user</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="p">}</span>

    <span class="n">it</span> <span class="p">{</span> <span class="n">is_expected</span><span class="p">.</span><span class="nf">to</span> <span class="n">have</span><span class="p">(</span><span class="mi">2</span><span class="p">).</span><span class="nf">items</span> <span class="p">}</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="doubles"><a class="anchor" href="#doubles"></a><a class="link" href="#doubles">Doubles</a></h3>
<div class="paragraph">
<p>Prefer using verifying doubles over normal doubles.</p>
</div>
<div class="paragraph">
<p>Verifying doubles are a stricter alternative to normal doubles that provide guarantees, e.g. a failure will be triggered if an invalid method is being stubbed or a method is called with an invalid number of arguments.</p>
</div>
<div class="paragraph">
<p>In general, use doubles with more isolated/behavioral tests rather than with integration tests.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
There is no justification for turning <code>verify_partial_doubles</code> configuration option off.
That will significantly reduce the confidence in partial doubles.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="ruby"><span class="c1"># good - verifying instance double</span>
<span class="n">article</span> <span class="o">=</span> <span class="n">instance_double</span><span class="p">(</span><span class="s1">'Article'</span><span class="p">)</span>
<span class="n">allow</span><span class="p">(</span><span class="n">article</span><span class="p">).</span><span class="nf">to</span> <span class="n">receive</span><span class="p">(</span><span class="ss">:author</span><span class="p">).</span><span class="nf">and_return</span><span class="p">(</span><span class="kp">nil</span><span class="p">)</span>

<span class="n">presenter</span> <span class="o">=</span> <span class="n">described_class</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">article</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">presenter</span><span class="p">.</span><span class="nf">title</span><span class="p">).</span><span class="nf">to</span> <span class="kp">include</span><span class="p">(</span><span class="s1">'by an unknown author'</span><span class="p">)</span>


<span class="c1"># good - verifying object double</span>
<span class="n">article</span> <span class="o">=</span> <span class="n">object_double</span><span class="p">(</span><span class="no">Article</span><span class="p">.</span><span class="nf">new</span><span class="p">,</span> <span class="ss">valid?: </span><span class="kp">true</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">article</span><span class="p">.</span><span class="nf">save</span><span class="p">).</span><span class="nf">to</span> <span class="n">be</span> <span class="kp">true</span>


<span class="c1"># good - verifying partial double</span>
<span class="n">allow</span><span class="p">(</span><span class="no">Article</span><span class="p">).</span><span class="nf">to</span> <span class="n">receive</span><span class="p">(</span><span class="ss">:find</span><span class="p">).</span><span class="nf">with</span><span class="p">(</span><span class="mi">5</span><span class="p">).</span><span class="nf">and_return</span><span class="p">(</span><span class="n">article</span><span class="p">)</span>


<span class="c1"># good - verifying class double</span>
<span class="n">notifier</span> <span class="o">=</span> <span class="n">class_double</span><span class="p">(</span><span class="s1">'Notifier'</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">notifier</span><span class="p">).</span><span class="nf">to</span> <span class="n">receive</span><span class="p">(</span><span class="ss">:notify</span><span class="p">).</span><span class="nf">with</span><span class="p">(</span><span class="s1">'suspended as'</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
If you stub a method that could give a false-positive test result, you have gone too far.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="dealing-with-time"><a class="anchor" href="#dealing-with-time"></a><a class="link" href="#dealing-with-time">Dealing with Time</a></h3>
<div class="paragraph">
<p>Always use <a href="https://github.com/travisjeffery/timecop">Timecop</a> instead of stubbing anything on Time or Date.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="ruby"><span class="n">describe</span> <span class="no">InvoiceReminder</span> <span class="k">do</span>
  <span class="n">subject</span><span class="p">(</span><span class="ss">:time_with_offset</span><span class="p">)</span> <span class="p">{</span> <span class="n">described_class</span><span class="p">.</span><span class="nf">new</span><span class="p">.</span><span class="nf">get_offset_time</span> <span class="p">}</span>

  <span class="c1"># bad</span>
  <span class="n">it</span> <span class="s1">'offsets the time 2 days into the future'</span> <span class="k">do</span>
    <span class="n">current_time</span> <span class="o">=</span> <span class="no">Time</span><span class="p">.</span><span class="nf">now</span>
    <span class="n">allow</span><span class="p">(</span><span class="no">Time</span><span class="p">).</span><span class="nf">to</span> <span class="n">receive</span><span class="p">(</span><span class="ss">:now</span><span class="p">).</span><span class="nf">and_return</span><span class="p">(</span><span class="n">current_time</span><span class="p">)</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">time_with_offset</span><span class="p">).</span><span class="nf">to</span> <span class="n">eq</span><span class="p">(</span><span class="n">current_time</span> <span class="o">+</span> <span class="mi">2</span><span class="p">.</span><span class="nf">days</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="c1"># good</span>
  <span class="n">it</span> <span class="s1">'offsets the time 2 days into the future'</span> <span class="k">do</span>
    <span class="no">Timecop</span><span class="p">.</span><span class="nf">freeze</span><span class="p">(</span><span class="no">Time</span><span class="p">.</span><span class="nf">now</span><span class="p">)</span> <span class="k">do</span>
      <span class="n">expect</span><span class="p">(</span><span class="n">time_with_offset</span><span class="p">).</span><span class="nf">to</span> <span class="n">eq</span> <span class="mi">2</span><span class="p">.</span><span class="nf">days</span><span class="p">.</span><span class="nf">from_now</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="stub-http-requests"><a class="anchor" href="#stub-http-requests"></a><a class="link" href="#stub-http-requests">Stub HTTP Requests</a></h3>
<div class="paragraph">
<p>Stub HTTP requests when the code is making them.
Avoid hitting real external services.</p>
</div>
<div class="paragraph">
<p>Use <a href="https://github.com/bblimke/webmock">webmock</a> and <a href="https://github.com/vcr/vcr">VCR</a> separately or <a href="http://marnen.github.com/webmock-presentation/webmock.html">together</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="ruby"><span class="c1"># good</span>
<span class="n">context</span> <span class="s1">'with unauthorized access'</span> <span class="k">do</span>
  <span class="n">let</span><span class="p">(</span><span class="ss">:uri</span><span class="p">)</span> <span class="p">{</span> <span class="s1">'http://api.lelylan.com/types'</span> <span class="p">}</span>

  <span class="n">before</span> <span class="p">{</span> <span class="n">stub_request</span><span class="p">(</span><span class="ss">:get</span><span class="p">,</span> <span class="n">uri</span><span class="p">).</span><span class="nf">to_return</span><span class="p">(</span><span class="ss">status: </span><span class="mi">401</span><span class="p">,</span> <span class="ss">body: </span><span class="n">fixture</span><span class="p">(</span><span class="s1">'401.json'</span><span class="p">))</span> <span class="p">}</span>

  <span class="n">it</span> <span class="s1">'returns access denied'</span> <span class="k">do</span>
    <span class="n">page</span><span class="p">.</span><span class="nf">driver</span><span class="p">.</span><span class="nf">get</span> <span class="n">uri</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">page</span><span class="p">).</span><span class="nf">to</span> <span class="n">have_content</span> <span class="s1">'Access denied'</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="declare-constants"><a class="anchor" href="#declare-constants"></a><a class="link" href="#declare-constants">Declare Constants</a></h3>
<div class="paragraph">
<p>Do not explicitly declare classes, modules, or constants in example groups.
<a href="https://relishapp.com/rspec/rspec-mocks/docs/mutating-constants">Stub constants instead</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Constants, including classes and modules, when declared in a block scope, are defined in global namespace, and leak between examples.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="ruby"><span class="c1"># bad</span>
<span class="n">describe</span> <span class="no">SomeClass</span> <span class="k">do</span>
  <span class="no">CONSTANT_HERE</span> <span class="o">=</span> <span class="s1">'I leak into global namespace'</span>
<span class="k">end</span>

<span class="c1"># good</span>
<span class="n">describe</span> <span class="no">SomeClass</span> <span class="k">do</span>
  <span class="n">before</span> <span class="k">do</span>
    <span class="n">stub_const</span><span class="p">(</span><span class="s1">'CONSTANT_HERE'</span><span class="p">,</span> <span class="s1">'I only exist during this example'</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="c1"># bad</span>
<span class="n">describe</span> <span class="no">SomeClass</span> <span class="k">do</span>
  <span class="k">class</span> <span class="nc">FooClass</span> <span class="o">&lt;</span> <span class="n">described_class</span>
    <span class="k">def</span> <span class="nf">double_that</span>
      <span class="n">some_base_method</span> <span class="o">*</span> <span class="mi">2</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="n">it</span> <span class="p">{</span> <span class="n">expect</span><span class="p">(</span><span class="no">FooClass</span><span class="p">.</span><span class="nf">new</span><span class="p">.</span><span class="nf">double_that</span><span class="p">).</span><span class="nf">to</span> <span class="n">eq</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="p">}</span>
<span class="k">end</span>

<span class="c1"># good - anonymous class, no constant needs to be defined</span>
<span class="n">describe</span> <span class="no">SomeClass</span> <span class="k">do</span>
  <span class="n">let</span><span class="p">(</span><span class="ss">:foo_class</span><span class="p">)</span> <span class="k">do</span>
    <span class="no">Class</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">described_class</span><span class="p">)</span> <span class="k">do</span>
      <span class="k">def</span> <span class="nf">double_that</span>
        <span class="n">some_base_method</span> <span class="o">*</span> <span class="mi">2</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="n">it</span> <span class="p">{</span> <span class="n">expect</span><span class="p">(</span><span class="n">foo_class</span><span class="p">.</span><span class="nf">new</span><span class="p">.</span><span class="nf">double_that</span><span class="p">).</span><span class="nf">to</span> <span class="n">eq</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="p">}</span>
<span class="k">end</span>

<span class="c1"># good - constant is stubbed</span>
<span class="n">describe</span> <span class="no">SomeClass</span> <span class="k">do</span>
  <span class="n">before</span> <span class="k">do</span>
    <span class="n">foo_class</span> <span class="o">=</span> <span class="no">Class</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">described_class</span><span class="p">)</span> <span class="k">do</span>
                  <span class="k">def</span> <span class="nf">do_something</span>
                  <span class="k">end</span>
                <span class="k">end</span>
    <span class="n">stub_const</span><span class="p">(</span><span class="s1">'FooClass'</span><span class="p">,</span> <span class="n">foo_class</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="n">it</span> <span class="p">{</span> <span class="n">expect</span><span class="p">(</span><span class="no">FooClass</span><span class="p">.</span><span class="nf">new</span><span class="p">.</span><span class="nf">double_that</span><span class="p">).</span><span class="nf">to</span> <span class="n">eq</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="p">}</span>
<span class="k">end</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="implicit-block-expectations"><a class="anchor" href="#implicit-block-expectations"></a><a class="link" href="#implicit-block-expectations">Implicit Block Expectations</a></h3>
<div class="paragraph">
<p>Avoid using implicit block expectations.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="ruby"><span class="c1"># bad</span>
<span class="n">subject</span> <span class="p">{</span> <span class="o">-&gt;</span> <span class="p">{</span> <span class="n">do_something</span> <span class="p">}</span> <span class="p">}</span>
<span class="n">it</span> <span class="p">{</span> <span class="n">is_expected</span><span class="p">.</span><span class="nf">to</span> <span class="n">change</span><span class="p">(</span><span class="n">something</span><span class="p">).</span><span class="nf">to</span><span class="p">(</span><span class="n">new_value</span><span class="p">)</span> <span class="p">}</span>

<span class="c1"># good</span>
<span class="n">it</span> <span class="s1">'changes something to a new value'</span> <span class="k">do</span>
  <span class="n">expect</span> <span class="p">{</span> <span class="n">do_something</span> <span class="p">}.</span><span class="nf">to</span> <span class="n">change</span><span class="p">(</span><span class="n">something</span><span class="p">).</span><span class="nf">to</span><span class="p">(</span><span class="n">new_value</span><span class="p">)</span>
<span class="k">end</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="naming"><a class="anchor" href="#naming"></a><a class="link" href="#naming">Naming</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="context-descriptions"><a class="anchor" href="#context-descriptions"></a><a class="link" href="#context-descriptions">Context Descriptions</a></h3>
<div class="paragraph">
<p>Context descriptions should describe the conditions shared by all the examples within. Full example names (formed by concatenation of all nested block descriptions) should form a readable sentence.</p>
</div>
<div class="paragraph">
<p>A typical description will be an adjunct phrase starting with 'when', 'with', 'without', or similar words.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="ruby"><span class="c1"># bad - 'Summary user logged in no display name shows a placeholder'</span>
<span class="n">describe</span> <span class="s1">'Summary'</span> <span class="k">do</span>
 <span class="n">context</span> <span class="s1">'user logged in'</span> <span class="k">do</span>
   <span class="n">context</span> <span class="s1">'no display name'</span> <span class="k">do</span>
     <span class="n">it</span> <span class="s1">'shows a placeholder'</span> <span class="k">do</span>
     <span class="k">end</span>
   <span class="k">end</span>
 <span class="k">end</span>
<span class="k">end</span>

<span class="c1"># good - 'Summary when the user is logged in when the display name is blank shows a placeholder'</span>
<span class="n">describe</span> <span class="s1">'Summary'</span> <span class="k">do</span>
 <span class="n">context</span> <span class="s1">'when the user is logged in'</span> <span class="k">do</span>
   <span class="n">context</span> <span class="s1">'when the display name is blank'</span> <span class="k">do</span>
     <span class="n">it</span> <span class="s1">'shows a placeholder'</span> <span class="k">do</span>
     <span class="k">end</span>
   <span class="k">end</span>
 <span class="k">end</span>
<span class="k">end</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="example-descriptions"><a class="anchor" href="#example-descriptions"></a><a class="link" href="#example-descriptions">Example Descriptions</a></h3>
<div class="paragraph">
<p><code>it</code>/<code>specify</code> block descriptions should never end with a conditional.
This is a code smell that the <code>it</code> most likely needs to be wrapped in a <code>context</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="ruby"><span class="c1"># bad</span>
<span class="n">it</span> <span class="s1">'returns the display name if it is present'</span> <span class="k">do</span>
  <span class="c1"># ...</span>
<span class="k">end</span>

<span class="c1"># good</span>
<span class="n">context</span> <span class="s1">'when display name is present'</span> <span class="k">do</span>
  <span class="n">it</span> <span class="s1">'returns the display name'</span> <span class="k">do</span>
    <span class="c1"># ...</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="c1"># This encourages the addition of negative test cases that might have</span>
<span class="c1"># been overlooked</span>
<span class="n">context</span> <span class="s1">'when display name is not present'</span> <span class="k">do</span>
  <span class="n">it</span> <span class="s1">'returns nil'</span> <span class="k">do</span>
    <span class="c1"># ...</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="keep-example-descriptions-short"><a class="anchor" href="#keep-example-descriptions-short"></a><a class="link" href="#keep-example-descriptions-short">Keep Example Descriptions Short</a></h3>
<div class="paragraph">
<p>Keep example description shorter than 60 characters.</p>
</div>
<div class="paragraph">
<p>Write the example that documents itself, and generates proper
documentation format output.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="ruby"><span class="c1"># bad</span>
<span class="n">it</span> <span class="s1">'rewrites "should not return something" as "does not return something"'</span> <span class="k">do</span>
  <span class="c1"># ...</span>
<span class="k">end</span>

<span class="c1"># good</span>
<span class="n">it</span> <span class="s1">'rewrites "should not return something"'</span> <span class="k">do</span>
  <span class="n">expect</span><span class="p">(</span><span class="n">rewrite</span><span class="p">(</span><span class="s1">'should not return something'</span><span class="p">)).</span><span class="nf">to</span>
    <span class="n">eq</span> <span class="s1">'does not return something'</span>
<span class="k">end</span>

<span class="c1"># good - self-documenting</span>
<span class="n">specify</span> <span class="k">do</span>
  <span class="n">expect</span><span class="p">(</span><span class="n">rewrite</span><span class="p">(</span><span class="s1">'should not return something'</span><span class="p">)).</span><span class="nf">to</span>
    <span class="n">eq</span> <span class="s1">'does not return something'</span>
<span class="k">end</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="should-in-example-docstrings"><a class="anchor" href="#should-in-example-docstrings"></a><a class="link" href="#should-in-example-docstrings">"Should" in Example Docstrings<a id="should-in-it"></a></a></h3>
<div class="paragraph">
<p>Do not write 'should' or 'should not' in the beginning of your example docstrings.
The descriptions represent actual functionality, not what might be happening.
Use the third person in the present tense.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="ruby"><span class="c1"># bad</span>
<span class="n">it</span> <span class="s1">'should return the summary'</span> <span class="k">do</span>
  <span class="c1"># ...</span>
<span class="k">end</span>

<span class="c1"># good</span>
<span class="n">it</span> <span class="s1">'returns the summary'</span> <span class="k">do</span>
  <span class="c1"># ...</span>
<span class="k">end</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="describe-the-methods"><a class="anchor" href="#describe-the-methods"></a><a class="link" href="#describe-the-methods">Describe the Methods<a id="example-group-naming"></a></a></h3>
<div class="paragraph">
<p>Be clear about what method you are describing.
Use the Ruby documentation convention of <code>.</code> when referring to a class method&#8217;s name and <code>#</code> when referring to an instance method&#8217;s name.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="ruby"><span class="c1"># bad</span>
<span class="n">describe</span> <span class="s1">'the authenticate method for User'</span> <span class="k">do</span>
  <span class="c1"># ...</span>
<span class="k">end</span>

<span class="n">describe</span> <span class="s1">'if the user is an admin'</span> <span class="k">do</span>
  <span class="c1"># ...</span>
<span class="k">end</span>

<span class="c1"># good</span>
<span class="n">describe</span> <span class="s1">'.authenticate'</span> <span class="k">do</span>
  <span class="c1"># ...</span>
<span class="k">end</span>

<span class="n">describe</span> <span class="s1">'#admin?'</span> <span class="k">do</span>
  <span class="c1"># ...</span>
<span class="k">end</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="use-expect"><a class="anchor" href="#use-expect"></a><a class="link" href="#use-expect">Use <code>expect</code></a></h3>
<div class="paragraph">
<p>Always use the newer <code>expect</code> syntax.</p>
</div>
<div class="paragraph">
<p>Configure RSpec to only accept the new <code>expect</code> syntax.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="ruby"><span class="c1"># bad</span>
<span class="n">it</span> <span class="s1">'creates a resource'</span> <span class="k">do</span>
  <span class="n">response</span><span class="p">.</span><span class="nf">should</span> <span class="n">respond_with_content_type</span><span class="p">(</span><span class="ss">:json</span><span class="p">)</span>
<span class="k">end</span>

<span class="c1"># good</span>
<span class="n">it</span> <span class="s1">'creates a resource'</span> <span class="k">do</span>
  <span class="n">expect</span><span class="p">(</span><span class="n">response</span><span class="p">).</span><span class="nf">to</span> <span class="n">respond_with_content_type</span><span class="p">(</span><span class="ss">:json</span><span class="p">)</span>
<span class="k">end</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="matchers"><a class="anchor" href="#matchers"></a><a class="link" href="#matchers">Matchers</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="predicate-matchers"><a class="anchor" href="#predicate-matchers"></a><a class="link" href="#predicate-matchers">Predicate Matchers</a></h3>
<div class="paragraph">
<p>Use RSpec&#8217;s predicate matcher methods when possible.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="ruby"><span class="n">describe</span> <span class="no">Article</span> <span class="k">do</span>
  <span class="n">subject</span><span class="p">(</span><span class="ss">:article</span><span class="p">)</span> <span class="p">{</span> <span class="no">FactoryBot</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="ss">:article</span><span class="p">)</span> <span class="p">}</span>

  <span class="c1"># bad</span>
  <span class="n">it</span> <span class="s1">'is published'</span> <span class="k">do</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">article</span><span class="p">.</span><span class="nf">published?</span><span class="p">).</span><span class="nf">to</span> <span class="n">be</span> <span class="kp">true</span>
  <span class="k">end</span>

  <span class="c1"># good</span>
  <span class="n">it</span> <span class="s1">'is published'</span> <span class="k">do</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">article</span><span class="p">).</span><span class="nf">to</span> <span class="n">be_published</span>
  <span class="k">end</span>

  <span class="c1"># even better</span>
  <span class="n">it</span> <span class="p">{</span> <span class="n">is_expected</span><span class="p">.</span><span class="nf">to</span> <span class="n">be_published</span> <span class="p">}</span>
<span class="k">end</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="built-in-matchers"><a class="anchor" href="#built-in-matchers"></a><a class="link" href="#built-in-matchers">Built in Matchers</a></h3>
<div class="paragraph">
<p>Use built-in matchers.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="ruby"><span class="c1"># bad</span>
<span class="n">it</span> <span class="s1">'includes a title'</span> <span class="k">do</span>
  <span class="n">expect</span><span class="p">(</span><span class="n">article</span><span class="p">.</span><span class="nf">title</span><span class="p">.</span><span class="nf">include?</span><span class="p">(</span><span class="s1">'a lengthy title'</span><span class="p">)).</span><span class="nf">to</span> <span class="n">be</span> <span class="kp">true</span>
<span class="k">end</span>

<span class="c1"># good</span>
<span class="n">it</span> <span class="s1">'includes a title'</span> <span class="k">do</span>
  <span class="n">expect</span><span class="p">(</span><span class="n">article</span><span class="p">.</span><span class="nf">title</span><span class="p">).</span><span class="nf">to</span> <span class="kp">include</span> <span class="s1">'a lengthy title'</span>
<span class="k">end</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="be-matcher"><a class="anchor" href="#be-matcher"></a><a class="link" href="#be-matcher"><code>be</code> Matcher</a></h3>
<div class="paragraph">
<p>Avoid using <code>be</code> matcher without arguments.
It is too generic, as it pass on everything that is not <code>nil</code> or <code>false</code>.
If that is the exact intent, use <code>be_truthy</code>.
In all other cases it&#8217;s better to specify what exactly is the expected value.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="ruby"><span class="c1"># bad</span>
<span class="n">it</span> <span class="s1">'has author'</span> <span class="k">do</span>
  <span class="n">expect</span><span class="p">(</span><span class="n">article</span><span class="p">.</span><span class="nf">author</span><span class="p">).</span><span class="nf">to</span> <span class="n">be</span>
<span class="k">end</span>

<span class="c1"># good</span>
<span class="n">it</span> <span class="s1">'has author'</span> <span class="k">do</span>
  <span class="n">expect</span><span class="p">(</span><span class="n">article</span><span class="p">.</span><span class="nf">author</span><span class="p">).</span><span class="nf">to</span> <span class="n">be_truthy</span> <span class="c1"># same as the original</span>
  <span class="n">expect</span><span class="p">(</span><span class="n">article</span><span class="p">.</span><span class="nf">author</span><span class="p">).</span><span class="nf">not_to</span> <span class="n">be_nil</span> <span class="c1"># `be` is often used to check for non-nil value</span>
  <span class="n">expect</span><span class="p">(</span><span class="n">article</span><span class="p">.</span><span class="nf">author</span><span class="p">).</span><span class="nf">to</span> <span class="n">be_an</span><span class="p">(</span><span class="no">Author</span><span class="p">)</span> <span class="c1"># explicit check for the type of the value</span>
<span class="k">end</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="extract-common-expectation-parts-into-matchers"><a class="anchor" href="#extract-common-expectation-parts-into-matchers"></a><a class="link" href="#extract-common-expectation-parts-into-matchers">Extract Common Expectation Parts into Matchers</a></h3>
<div class="paragraph">
<p>Extract frequently used common logic from your examples into <a href="https://relishapp.com/rspec/rspec-expectations/docs/custom-matchers/define-a-custom-matcher">custom matchers</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="ruby"><span class="c1"># bad</span>
<span class="n">it</span> <span class="s1">'returns JSON with temperature in Celsius'</span> <span class="k">do</span>
  <span class="n">json</span> <span class="o">=</span> <span class="no">JSON</span><span class="p">.</span><span class="nf">parse</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="nf">body</span><span class="p">).</span><span class="nf">with_indifferent_access</span>
  <span class="n">expect</span><span class="p">(</span><span class="n">json</span><span class="p">[</span><span class="ss">:celsius</span><span class="p">]).</span><span class="nf">to</span> <span class="n">eq</span> <span class="mi">30</span>
<span class="k">end</span>

<span class="n">it</span> <span class="s1">'returns JSON with temperature in Fahrenheit'</span> <span class="k">do</span>
  <span class="n">json</span> <span class="o">=</span> <span class="no">JSON</span><span class="p">.</span><span class="nf">parse</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="nf">body</span><span class="p">).</span><span class="nf">with_indifferent_access</span>
  <span class="n">expect</span><span class="p">(</span><span class="n">json</span><span class="p">[</span><span class="ss">:fahrenheit</span><span class="p">]).</span><span class="nf">to</span> <span class="n">eq</span> <span class="mi">86</span>
<span class="k">end</span>

<span class="c1"># good</span>
<span class="n">it</span> <span class="s1">'returns JSON with temperature in Celsius'</span> <span class="k">do</span>
  <span class="n">expect</span><span class="p">(</span><span class="n">response</span><span class="p">).</span><span class="nf">to</span> <span class="n">include_json</span><span class="p">(</span><span class="ss">celsius: </span><span class="mi">30</span><span class="p">)</span>
<span class="k">end</span>

<span class="n">it</span> <span class="s1">'returns JSON with temperature in Fahrenheit'</span> <span class="k">do</span>
  <span class="n">expect</span><span class="p">(</span><span class="n">response</span><span class="p">).</span><span class="nf">to</span> <span class="n">include_json</span><span class="p">(</span><span class="ss">fahrenheit: </span><span class="mi">86</span><span class="p">)</span>
<span class="k">end</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="any_instance_of"><a class="anchor" href="#any_instance_of"></a><a class="link" href="#any_instance_of"><code>any_instance_of</code></a></h3>
<div class="paragraph">
<p>Avoid using <code>allow_any_instance_of</code>/<code>expect_any_instance_of</code>.
It might be an indication that the object under test is too complex, and is ambiguous when used with receive counts.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="ruby"><span class="c1"># bad</span>
<span class="n">it</span> <span class="s1">'has a name'</span> <span class="k">do</span>
  <span class="n">allow_any_instance_of</span><span class="p">(</span><span class="no">User</span><span class="p">).</span><span class="nf">to</span> <span class="n">receive</span><span class="p">(</span><span class="ss">:name</span><span class="p">).</span><span class="nf">and_return</span><span class="p">(</span><span class="s1">'Tweedledee'</span><span class="p">)</span>
  <span class="n">expect</span><span class="p">(</span><span class="n">account</span><span class="p">.</span><span class="nf">name</span><span class="p">).</span><span class="nf">to</span> <span class="n">eq</span> <span class="s1">'Tweedledee'</span>
<span class="k">end</span>

<span class="c1"># good</span>
<span class="n">let</span><span class="p">(</span><span class="ss">:account</span><span class="p">)</span> <span class="p">{</span> <span class="no">Account</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">user</span><span class="p">)</span> <span class="p">}</span>

<span class="n">it</span> <span class="s1">'has a name'</span> <span class="k">do</span>
  <span class="n">allow</span><span class="p">(</span><span class="n">user</span><span class="p">).</span><span class="nf">to</span> <span class="n">receive</span><span class="p">(</span><span class="ss">:name</span><span class="p">).</span><span class="nf">and_return</span><span class="p">(</span><span class="s1">'Tweedledee'</span><span class="p">)</span>
  <span class="n">expect</span><span class="p">(</span><span class="n">account</span><span class="p">.</span><span class="nf">name</span><span class="p">).</span><span class="nf">to</span> <span class="n">eq</span> <span class="s1">'Tweedledee'</span>
<span class="k">end</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="matcher-libraries"><a class="anchor" href="#matcher-libraries"></a><a class="link" href="#matcher-libraries">Matcher Libraries</a></h3>
<div class="paragraph">
<p>Use third-party matcher libraries that provide convenience helpers that will significantly simplify the examples, <a href="https://github.com/thoughtbot/shoulda-matchers">Shoulda Matchers</a> are one worth mentioning.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="ruby"><span class="c1"># bad</span>
<span class="n">describe</span> <span class="s1">'#title'</span> <span class="k">do</span>
  <span class="n">it</span> <span class="s1">'is required'</span> <span class="k">do</span>
    <span class="n">article</span><span class="p">.</span><span class="nf">title</span> <span class="o">=</span> <span class="kp">nil</span>
    <span class="n">article</span><span class="p">.</span><span class="nf">valid?</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">article</span><span class="p">.</span><span class="nf">errors</span><span class="p">[</span><span class="ss">:title</span><span class="p">])</span>
      <span class="p">.</span><span class="nf">to</span> <span class="n">contain_exactly</span><span class="p">(</span><span class="s1">'Article has no title'</span><span class="p">)</span>
    <span class="n">not</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="c1"># good</span>
<span class="n">describe</span> <span class="s1">'#title'</span> <span class="k">do</span>
  <span class="n">it</span> <span class="s1">'is required'</span> <span class="k">do</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">article</span><span class="p">).</span><span class="nf">to</span> <span class="n">validate_presence_of</span><span class="p">(</span><span class="ss">:title</span><span class="p">)</span>
      <span class="p">.</span><span class="nf">with_message</span><span class="p">(</span><span class="s1">'Article has no title'</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="rails-integration"><a class="anchor" href="#rails-integration"></a><a class="link" href="#rails-integration">Rails: Integration<a id="integration"></a><a id="rails"></a></a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Test what you see.
Deeply test your models and your application behaviour (integration tests).
Do not add useless complexity testing controllers.</p>
</div>
<div class="paragraph">
<p>This is an open debate in the Ruby community and both sides have good arguments supporting their idea.
People supporting the need of testing controllers will tell you that your integration tests don&#8217;t cover all use cases and that they are slow.
Both are wrong.
It is possible to cover all use cases and it&#8217;s possible to make them fast.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="rails-views"><a class="anchor" href="#rails-views"></a><a class="link" href="#rails-views">Rails: Views<a id="views"></a></a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="view-directory-structure"><a class="anchor" href="#view-directory-structure"></a><a class="link" href="#view-directory-structure">View Directory Structure</a></h3>
<div class="paragraph">
<p>The directory structure of the view specs <code>spec/views</code> matches the one in <code>app/views</code>.
For example the specs for the views in <code>app/views/users</code> are placed in <code>spec/views/users</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="view-spec-file-name"><a class="anchor" href="#view-spec-file-name"></a><a class="link" href="#view-spec-file-name">View Spec File Name</a></h3>
<div class="paragraph">
<p>The naming convention for the view specs is adding <code>_spec.rb</code> to the view name, for example the view <code>_form.html.erb</code> has a corresponding spec <code>_form.html.erb_spec.rb</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="view-outer-describe"><a class="anchor" href="#view-outer-describe"></a><a class="link" href="#view-outer-describe">View Outer <code>describe</code></a></h3>
<div class="paragraph">
<p>The outer <code>describe</code> block uses the path to the view without the <code>app/views</code> part.
This is used by the <code>render</code> method when it is called without arguments.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="ruby"><span class="c1"># spec/views/articles/new.html.erb_spec.rb</span>
<span class="n">describe</span> <span class="s1">'articles/new.html.erb'</span> <span class="k">do</span>
  <span class="c1"># ...</span>
<span class="k">end</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="view-mock-models"><a class="anchor" href="#view-mock-models"></a><a class="link" href="#view-mock-models">View Mock Models</a></h3>
<div class="paragraph">
<p>Always mock the models in the view specs.
The purpose of the view is only to display information.</p>
</div>
</div>
<div class="sect2">
<h3 id="view-assign"><a class="anchor" href="#view-assign"></a><a class="link" href="#view-assign">View <code>assign</code></a></h3>
<div class="paragraph">
<p>The method <code>assign</code> supplies the instance variables which the view uses and are supplied by the controller.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="ruby"><span class="c1"># spec/views/articles/edit.html.erb_spec.rb</span>
<span class="n">describe</span> <span class="s1">'articles/edit.html.erb'</span> <span class="k">do</span>
  <span class="n">it</span> <span class="s1">'renders the form for a new article creation'</span> <span class="k">do</span>
    <span class="n">assign</span><span class="p">(</span><span class="ss">:article</span><span class="p">,</span> <span class="n">double</span><span class="p">(</span><span class="no">Article</span><span class="p">).</span><span class="nf">as_null_object</span><span class="p">)</span>
    <span class="n">render</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">rendered</span><span class="p">).</span><span class="nf">to</span> <span class="n">have_selector</span><span class="p">(</span><span class="s1">'form'</span><span class="p">,</span>
      <span class="ss">method: </span><span class="s1">'post'</span><span class="p">,</span>
      <span class="ss">action: </span><span class="n">articles_path</span>
    <span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">form</span><span class="o">|</span>
      <span class="n">expect</span><span class="p">(</span><span class="n">form</span><span class="p">).</span><span class="nf">to</span> <span class="n">have_selector</span><span class="p">(</span><span class="s1">'input'</span><span class="p">,</span> <span class="ss">type: </span><span class="s1">'submit'</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="capybara-negative-selectors"><a class="anchor" href="#capybara-negative-selectors"></a><a class="link" href="#capybara-negative-selectors">Capybara Negative Selectors<a id="view-capybara-negative-selectors"></a></a></h3>
<div class="paragraph">
<p>Prefer capybara negative selectors over <code>to_not</code> with positive ones.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="ruby"><span class="c1"># bad</span>
<span class="n">expect</span><span class="p">(</span><span class="n">page</span><span class="p">).</span><span class="nf">to_not</span> <span class="n">have_selector</span><span class="p">(</span><span class="s1">'input'</span><span class="p">,</span> <span class="ss">type: </span><span class="s1">'submit'</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">page</span><span class="p">).</span><span class="nf">to_not</span> <span class="n">have_xpath</span><span class="p">(</span><span class="s1">'tr'</span><span class="p">)</span>

<span class="c1"># good</span>
<span class="n">expect</span><span class="p">(</span><span class="n">page</span><span class="p">).</span><span class="nf">to</span> <span class="n">have_no_selector</span><span class="p">(</span><span class="s1">'input'</span><span class="p">,</span> <span class="ss">type: </span><span class="s1">'submit'</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">page</span><span class="p">).</span><span class="nf">to</span> <span class="n">have_no_xpath</span><span class="p">(</span><span class="s1">'tr'</span><span class="p">)</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="view-helper-stub"><a class="anchor" href="#view-helper-stub"></a><a class="link" href="#view-helper-stub">View Helper Stub</a></h3>
<div class="paragraph">
<p>When a view uses helper methods, these methods need to be stubbed.
Stubbing the helper methods is done on the <code>template</code> object:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="ruby"><span class="c1"># app/helpers/articles_helper.rb</span>
<span class="k">class</span> <span class="nc">ArticlesHelper</span>
  <span class="k">def</span> <span class="nf">formatted_date</span><span class="p">(</span><span class="n">date</span><span class="p">)</span>
    <span class="c1"># ...</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="ruby"><span class="c1"># app/views/articles/show.html.erb</span>
<span class="o">&lt;</span><span class="sx">%= 'Published at: #{formatted_date(@article.published_at)}' %&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="ruby"><span class="c1"># spec/views/articles/show.html.erb_spec.rb</span>
<span class="n">describe</span> <span class="s1">'articles/show.html.erb'</span> <span class="k">do</span>
  <span class="n">it</span> <span class="s1">'displays the formatted date of article publishing'</span> <span class="k">do</span>
    <span class="n">article</span> <span class="o">=</span> <span class="n">double</span><span class="p">(</span><span class="no">Article</span><span class="p">,</span> <span class="ss">published_at: </span><span class="no">Date</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2012</span><span class="p">,</span> <span class="mo">01</span><span class="p">,</span> <span class="mo">01</span><span class="p">))</span>
    <span class="n">assign</span><span class="p">(</span><span class="ss">:article</span><span class="p">,</span> <span class="n">article</span><span class="p">)</span>

    <span class="n">allow</span><span class="p">(</span><span class="n">template</span><span class="p">).</span><span class="nf">to_receive</span><span class="p">(</span><span class="ss">:formatted_date</span><span class="p">).</span><span class="nf">with</span><span class="p">(</span><span class="n">article</span><span class="p">.</span><span class="nf">published_at</span><span class="p">).</span><span class="nf">and_return</span><span class="p">(</span><span class="s1">'01.01.2012'</span><span class="p">)</span>

    <span class="n">render</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">rendered</span><span class="p">).</span><span class="nf">to</span> <span class="n">have_content</span><span class="p">(</span><span class="s1">'Published at: 01.01.2012'</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="view-helpers"><a class="anchor" href="#view-helpers"></a><a class="link" href="#view-helpers">View Helpers</a></h3>
<div class="paragraph">
<p>The helpers specs are separated from the view specs in the <code>spec/helpers</code> directory.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="rails-controllers"><a class="anchor" href="#rails-controllers"></a><a class="link" href="#rails-controllers">Rails: Controllers<a id="controllers"></a></a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="controller-models"><a class="anchor" href="#controller-models"></a><a class="link" href="#controller-models">Controller Models</a></h3>
<div class="paragraph">
<p>Mock the models and stub their methods.
Testing the controller should not depend on the model creation.</p>
</div>
</div>
<div class="sect2">
<h3 id="controller-behaviour"><a class="anchor" href="#controller-behaviour"></a><a class="link" href="#controller-behaviour">Controller Behaviour</a></h3>
<div class="paragraph">
<p>Test only the behaviour the controller should be responsible about:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Execution of particular methods</p>
</li>
<li>
<p>Data returned from the action - assigns, etc.</p>
</li>
<li>
<p>Result from the action - template render, redirect, etc.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="ruby"><span class="c1"># Example of a commonly used controller spec</span>
<span class="c1"># spec/controllers/articles_controller_spec.rb</span>
<span class="c1"># We are interested only in the actions the controller should perform</span>
<span class="c1"># So we are mocking the model creation and stubbing its methods</span>
<span class="c1"># And we concentrate only on the things the controller should do</span>

<span class="n">describe</span> <span class="no">ArticlesController</span> <span class="k">do</span>
  <span class="c1"># The model will be used in the specs for all methods of the controller</span>
  <span class="n">let</span><span class="p">(</span><span class="ss">:article</span><span class="p">)</span> <span class="p">{</span> <span class="n">double</span><span class="p">(</span><span class="no">Article</span><span class="p">)</span> <span class="p">}</span>

  <span class="n">describe</span> <span class="s1">'POST create'</span> <span class="k">do</span>
    <span class="n">before</span> <span class="p">{</span> <span class="n">allow</span><span class="p">(</span><span class="no">Article</span><span class="p">).</span><span class="nf">to</span> <span class="n">receive</span><span class="p">(</span><span class="ss">:new</span><span class="p">).</span><span class="nf">and_return</span><span class="p">(</span><span class="n">article</span><span class="p">)</span> <span class="p">}</span>

    <span class="n">it</span> <span class="s1">'creates a new article with the given attributes'</span> <span class="k">do</span>
      <span class="n">expect</span><span class="p">(</span><span class="no">Article</span><span class="p">).</span><span class="nf">to</span> <span class="n">receive</span><span class="p">(</span><span class="ss">:new</span><span class="p">).</span><span class="nf">with</span><span class="p">(</span><span class="ss">title: </span><span class="s1">'The New Article Title'</span><span class="p">).</span><span class="nf">and_return</span><span class="p">(</span><span class="n">article</span><span class="p">)</span>
      <span class="n">post</span> <span class="ss">:create</span><span class="p">,</span> <span class="ss">message: </span><span class="p">{</span> <span class="ss">title: </span><span class="s1">'The New Article Title'</span> <span class="p">}</span>
    <span class="k">end</span>

    <span class="n">it</span> <span class="s1">'saves the article'</span> <span class="k">do</span>
      <span class="n">expect</span><span class="p">(</span><span class="n">article</span><span class="p">).</span><span class="nf">to</span> <span class="n">receive</span><span class="p">(</span><span class="ss">:save</span><span class="p">)</span>
      <span class="n">post</span> <span class="ss">:create</span>
    <span class="k">end</span>

    <span class="n">it</span> <span class="s1">'redirects to the Articles index'</span> <span class="k">do</span>
      <span class="n">allow</span><span class="p">(</span><span class="n">article</span><span class="p">).</span><span class="nf">to</span> <span class="n">receive</span><span class="p">(</span><span class="ss">:save</span><span class="p">)</span>
      <span class="n">post</span> <span class="ss">:create</span>
      <span class="n">expect</span><span class="p">(</span><span class="n">response</span><span class="p">).</span><span class="nf">to</span> <span class="n">redirect_to</span><span class="p">(</span><span class="ss">action: </span><span class="s1">'index'</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="controller-contexts"><a class="anchor" href="#controller-contexts"></a><a class="link" href="#controller-contexts">Controller Contexts</a></h3>
<div class="paragraph">
<p>Use context when the controller action has different behaviour depending on the received params.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="ruby"><span class="c1"># A classic example for use of contexts in a controller spec is creation or update when the object saves successfully or not.</span>

<span class="n">describe</span> <span class="no">ArticlesController</span> <span class="k">do</span>
  <span class="n">let</span><span class="p">(</span><span class="ss">:article</span><span class="p">)</span> <span class="p">{</span> <span class="n">double</span><span class="p">(</span><span class="no">Article</span><span class="p">)</span> <span class="p">}</span>

  <span class="n">describe</span> <span class="s1">'POST create'</span> <span class="k">do</span>
    <span class="n">before</span> <span class="p">{</span> <span class="n">allow</span><span class="p">(</span><span class="no">Article</span><span class="p">).</span><span class="nf">to</span> <span class="n">receive</span><span class="p">(</span><span class="ss">:new</span><span class="p">).</span><span class="nf">and_return</span><span class="p">(</span><span class="n">article</span><span class="p">)</span> <span class="p">}</span>

    <span class="n">it</span> <span class="s1">'creates a new article with the given attributes'</span> <span class="k">do</span>
      <span class="n">expect</span><span class="p">(</span><span class="no">Article</span><span class="p">).</span><span class="nf">to</span> <span class="n">receive</span><span class="p">(</span><span class="ss">:new</span><span class="p">).</span><span class="nf">with</span><span class="p">(</span><span class="ss">title: </span><span class="s1">'The New Article Title'</span><span class="p">).</span><span class="nf">and_return</span><span class="p">(</span><span class="n">article</span><span class="p">)</span>
      <span class="n">post</span> <span class="ss">:create</span><span class="p">,</span> <span class="ss">article: </span><span class="p">{</span> <span class="ss">title: </span><span class="s1">'The New Article Title'</span> <span class="p">}</span>
    <span class="k">end</span>

    <span class="n">it</span> <span class="s1">'saves the article'</span> <span class="k">do</span>
      <span class="n">expect</span><span class="p">(</span><span class="n">article</span><span class="p">).</span><span class="nf">to</span> <span class="n">receive</span><span class="p">(</span><span class="ss">:save</span><span class="p">)</span>
      <span class="n">post</span> <span class="ss">:create</span>
    <span class="k">end</span>

    <span class="n">context</span> <span class="s1">'when the article saves successfully'</span> <span class="k">do</span>
      <span class="n">before</span> <span class="k">do</span>
        <span class="n">allow</span><span class="p">(</span><span class="n">article</span><span class="p">).</span><span class="nf">to</span> <span class="n">receive</span><span class="p">(</span><span class="ss">:save</span><span class="p">).</span><span class="nf">and_return</span><span class="p">(</span><span class="kp">true</span><span class="p">)</span>
      <span class="k">end</span>

      <span class="n">it</span> <span class="s1">'sets a flash[:notice] message'</span> <span class="k">do</span>
        <span class="n">post</span> <span class="ss">:create</span>
        <span class="n">expect</span><span class="p">(</span><span class="n">flash</span><span class="p">[</span><span class="ss">:notice</span><span class="p">]).</span><span class="nf">to</span> <span class="n">eq</span><span class="p">(</span><span class="s1">'The article was saved successfully.'</span><span class="p">)</span>
      <span class="k">end</span>

      <span class="n">it</span> <span class="s1">'redirects to the Articles index'</span> <span class="k">do</span>
        <span class="n">post</span> <span class="ss">:create</span>
        <span class="n">expect</span><span class="p">(</span><span class="n">response</span><span class="p">).</span><span class="nf">to</span> <span class="n">redirect_to</span><span class="p">(</span><span class="ss">action: </span><span class="s1">'index'</span><span class="p">)</span>
      <span class="k">end</span>
    <span class="k">end</span>

    <span class="n">context</span> <span class="s1">'when the article fails to save'</span> <span class="k">do</span>
      <span class="n">before</span> <span class="k">do</span>
        <span class="n">allow</span><span class="p">(</span><span class="n">article</span><span class="p">).</span><span class="nf">to</span> <span class="n">receive</span><span class="p">(</span><span class="ss">:save</span><span class="p">).</span><span class="nf">and_return</span><span class="p">(</span><span class="kp">false</span><span class="p">)</span>
      <span class="k">end</span>

      <span class="n">it</span> <span class="s1">'assigns @article'</span> <span class="k">do</span>
        <span class="n">post</span> <span class="ss">:create</span>
        <span class="n">expect</span><span class="p">(</span><span class="n">assigns</span><span class="p">[</span><span class="ss">:article</span><span class="p">]).</span><span class="nf">to</span> <span class="n">eq</span><span class="p">(</span><span class="n">article</span><span class="p">)</span>
      <span class="k">end</span>

      <span class="n">it</span> <span class="s2">"re-renders the 'new' template"</span> <span class="k">do</span>
        <span class="n">post</span> <span class="ss">:create</span>
        <span class="n">expect</span><span class="p">(</span><span class="n">response</span><span class="p">).</span><span class="nf">to</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">'new'</span><span class="p">)</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="rails-models"><a class="anchor" href="#rails-models"></a><a class="link" href="#rails-models">Rails: Models<a id="models"></a></a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="model-mocks"><a class="anchor" href="#model-mocks"></a><a class="link" href="#model-mocks">Model Mocks</a></h3>
<div class="paragraph">
<p>Do not mock the models in their own specs.</p>
</div>
</div>
<div class="sect2">
<h3 id="model-objects"><a class="anchor" href="#model-objects"></a><a class="link" href="#model-objects">Model Objects</a></h3>
<div class="paragraph">
<p>Use <code>FactoryBot.create</code> to make real objects, or just use a new (unsaved) instance with <code>subject</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="ruby"><span class="n">describe</span> <span class="no">Article</span> <span class="k">do</span>
  <span class="n">subject</span><span class="p">(</span><span class="ss">:article</span><span class="p">)</span> <span class="p">{</span> <span class="no">FactoryBot</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="ss">:article</span><span class="p">)</span> <span class="p">}</span>

  <span class="n">it</span> <span class="p">{</span> <span class="n">is_expected</span><span class="p">.</span><span class="nf">to</span> <span class="n">be_an</span> <span class="no">Article</span> <span class="p">}</span>
  <span class="n">it</span> <span class="p">{</span> <span class="n">is_expected</span><span class="p">.</span><span class="nf">to</span> <span class="n">be_persisted</span> <span class="p">}</span>
<span class="k">end</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="model-mock-associations"><a class="anchor" href="#model-mock-associations"></a><a class="link" href="#model-mock-associations">Model Mock Associations</a></h3>
<div class="paragraph">
<p>It is acceptable to mock other models or child objects.</p>
</div>
</div>
<div class="sect2">
<h3 id="avoid-duplication-in-model-tests"><a class="anchor" href="#avoid-duplication-in-model-tests"></a><a class="link" href="#avoid-duplication-in-model-tests">Avoid Duplication in Model Tests<a id="model-avoid-duplication"></a></a></h3>
<div class="paragraph">
<p>Create the model for all examples in the spec to avoid duplication.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="ruby"><span class="n">describe</span> <span class="no">Article</span> <span class="k">do</span>
  <span class="n">let</span><span class="p">(</span><span class="ss">:article</span><span class="p">)</span> <span class="p">{</span> <span class="no">FactoryBot</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="ss">:article</span><span class="p">)</span> <span class="p">}</span>
<span class="k">end</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="check-model-validity"><a class="anchor" href="#check-model-validity"></a><a class="link" href="#check-model-validity">Check Model Validity<a id="model-check-validity"></a></a></h3>
<div class="paragraph">
<p>Add an example ensuring that the model created with <code>FactoryBot.create</code> is valid.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="ruby"><span class="n">describe</span> <span class="no">Article</span> <span class="k">do</span>
  <span class="n">it</span> <span class="s1">'is valid with valid attributes'</span> <span class="k">do</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">article</span><span class="p">).</span><span class="nf">to</span> <span class="n">be_valid</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="model-validations"><a class="anchor" href="#model-validations"></a><a class="link" href="#model-validations">Model Validations</a></h3>
<div class="paragraph">
<p>When testing validations, use <code>expect(model.errors[:attribute].size).to eq(x)</code> to specify the attribute which should be validated.
Using <code>be_valid</code> does not guarantee that the problem is in the intended attribute.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="ruby"><span class="c1"># bad</span>
<span class="n">describe</span> <span class="s1">'#title'</span> <span class="k">do</span>
  <span class="n">it</span> <span class="s1">'is required'</span> <span class="k">do</span>
    <span class="n">article</span><span class="p">.</span><span class="nf">title</span> <span class="o">=</span> <span class="kp">nil</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">article</span><span class="p">).</span><span class="nf">to_not</span> <span class="n">be_valid</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="c1"># preferred</span>
<span class="n">describe</span> <span class="s1">'#title'</span> <span class="k">do</span>
  <span class="n">it</span> <span class="s1">'is required'</span> <span class="k">do</span>
    <span class="n">article</span><span class="p">.</span><span class="nf">title</span> <span class="o">=</span> <span class="kp">nil</span>
    <span class="n">article</span><span class="p">.</span><span class="nf">valid?</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">article</span><span class="p">.</span><span class="nf">errors</span><span class="p">[</span><span class="ss">:title</span><span class="p">].</span><span class="nf">size</span><span class="p">).</span><span class="nf">to</span> <span class="n">eq</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="separate-example-group-for-attribute-validations"><a class="anchor" href="#separate-example-group-for-attribute-validations"></a><a class="link" href="#separate-example-group-for-attribute-validations">Separate Example Group for Attribute Validations<a id="model-separate-describe-for-attribute-validations"></a></a></h3>
<div class="paragraph">
<p>Add a separate <code>describe</code> for each attribute which has validations.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="ruby"><span class="n">describe</span> <span class="s1">'#title'</span> <span class="k">do</span>
  <span class="n">it</span> <span class="s1">'is required'</span> <span class="k">do</span>
    <span class="n">article</span><span class="p">.</span><span class="nf">title</span> <span class="o">=</span> <span class="kp">nil</span>
    <span class="n">article</span><span class="p">.</span><span class="nf">valid?</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">article</span><span class="p">.</span><span class="nf">errors</span><span class="p">[</span><span class="ss">:title</span><span class="p">].</span><span class="nf">size</span><span class="p">).</span><span class="nf">to</span> <span class="n">eq</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="n">describe</span> <span class="s1">'#name'</span> <span class="k">do</span>
  <span class="n">it</span> <span class="s1">'is required'</span> <span class="k">do</span>
    <span class="n">article</span><span class="p">.</span><span class="nf">name</span> <span class="o">=</span> <span class="kp">nil</span>
    <span class="n">article</span><span class="p">.</span><span class="nf">valid?</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">article</span><span class="p">.</span><span class="nf">errors</span><span class="p">[</span><span class="ss">:name</span><span class="p">].</span><span class="nf">size</span><span class="p">).</span><span class="nf">to</span> <span class="n">eq</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="naming-another-object"><a class="anchor" href="#naming-another-object"></a><a class="link" href="#naming-another-object">Naming Another Object<a id="model-name-another-object"></a></a></h3>
<div class="paragraph">
<p>When testing uniqueness of a model attribute, name the other object <code>another_object</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="ruby"><span class="n">describe</span> <span class="no">Article</span> <span class="k">do</span>
  <span class="n">describe</span> <span class="s1">'#title'</span> <span class="k">do</span>
    <span class="n">it</span> <span class="s1">'is unique'</span> <span class="k">do</span>
      <span class="n">another_article</span> <span class="o">=</span> <span class="no">FactoryBot</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="ss">:article</span><span class="p">,</span> <span class="ss">title: </span><span class="n">article</span><span class="p">.</span><span class="nf">title</span><span class="p">)</span>
      <span class="n">article</span><span class="p">.</span><span class="nf">valid?</span>
      <span class="n">expect</span><span class="p">(</span><span class="n">article</span><span class="p">.</span><span class="nf">errors</span><span class="p">[</span><span class="ss">:title</span><span class="p">].</span><span class="nf">size</span><span class="p">).</span><span class="nf">to</span> <span class="n">eq</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="rails-mailers"><a class="anchor" href="#rails-mailers"></a><a class="link" href="#rails-mailers">Rails: Mailers<a id="mailers"></a></a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="mailer-mock-model"><a class="anchor" href="#mailer-mock-model"></a><a class="link" href="#mailer-mock-model">Mailer Mock Model</a></h3>
<div class="paragraph">
<p>The model in the mailer spec should be mocked.
The mailer should not depend on the model creation.</p>
</div>
</div>
<div class="sect2">
<h3 id="mailer-expectations"><a class="anchor" href="#mailer-expectations"></a><a class="link" href="#mailer-expectations">Mailer Expectations</a></h3>
<div class="paragraph">
<p>The mailer spec should verify that:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the subject is correct</p>
</li>
<li>
<p>the sender e-mail is correct</p>
</li>
<li>
<p>the e-mail is sent to the correct recipient</p>
</li>
<li>
<p>the e-mail contains the required information</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="ruby"><span class="n">describe</span> <span class="no">SubscriberMailer</span> <span class="k">do</span>
  <span class="n">let</span><span class="p">(</span><span class="ss">:subscriber</span><span class="p">)</span> <span class="p">{</span> <span class="n">double</span><span class="p">(</span><span class="no">Subscription</span><span class="p">,</span> <span class="ss">email: </span><span class="s1">'johndoe@test.com'</span><span class="p">,</span> <span class="ss">name: </span><span class="s1">'John Doe'</span><span class="p">)</span> <span class="p">}</span>

  <span class="n">describe</span> <span class="s1">'successful registration email'</span> <span class="k">do</span>
    <span class="n">subject</span><span class="p">(</span><span class="ss">:email</span><span class="p">)</span> <span class="p">{</span> <span class="no">SubscriptionMailer</span><span class="p">.</span><span class="nf">successful_registration_email</span><span class="p">(</span><span class="n">subscriber</span><span class="p">)</span> <span class="p">}</span>

    <span class="n">it</span> <span class="p">{</span> <span class="n">is_expected</span><span class="p">.</span><span class="nf">to</span> <span class="n">have_attributes</span><span class="p">(</span><span class="ss">subject: </span><span class="s1">'Successful Registration!'</span><span class="p">,</span> <span class="ss">from: </span><span class="p">[</span><span class="s1">'infor@your_site.com'</span><span class="p">],</span> <span class="ss">to: </span><span class="p">[</span><span class="n">subscriber</span><span class="p">.</span><span class="nf">email</span><span class="p">])</span> <span class="p">}</span>

    <span class="n">it</span> <span class="s1">'contains the subscriber name'</span> <span class="k">do</span>
      <span class="n">expect</span><span class="p">(</span><span class="n">email</span><span class="p">.</span><span class="nf">body</span><span class="p">.</span><span class="nf">encoded</span><span class="p">).</span><span class="nf">to</span> <span class="n">match</span><span class="p">(</span><span class="n">subscriber</span><span class="p">.</span><span class="nf">name</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="recommendations"><a class="anchor" href="#recommendations"></a><a class="link" href="#recommendations">Recommendations</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="correct-setup"><a class="anchor" href="#correct-setup"></a><a class="link" href="#correct-setup">Correct Setup</a></h3>
<div class="paragraph">
<p>Correctly set up RSpec configuration globally (<code>~/.rspec</code>), per project (<code>.rspec</code>), and in project override file that is supposed to be kept out of version control (<code>.rspec-local</code>).
Use <code>rspec --init</code> to generate <code>.rspec</code> and <code>spec/spec_helper.rb</code> files.</p>
</div>
<div class="listingblock">
<div class="content">
<pre># .rspec
--color
--require spec_helper

# .rspec-local
--profile 2</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="related-guides"><a class="anchor" href="#related-guides"></a><a class="link" href="#related-guides">Related Guides</a></h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="https://rubystyle.guide">Ruby Style Guide</a></p>
</li>
<li>
<p><a href="https://rails.rubystyle.guide">Rails Style Guide</a></p>
</li>
<li>
<p><a href="https://minitest.rubystyle.guide">Minitest Style Guide</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="contributing"><a class="anchor" href="#contributing"></a><a class="link" href="#contributing">Contributing</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Nothing written in this guide is set in stone.
Everyone is welcome to contribute, so that we could ultimately create a resource that will be beneficial to the entire Ruby community.</p>
</div>
<div class="paragraph">
<p>Feel free to open tickets or send pull requests with improvements.
Thanks in advance for your help!</p>
</div>
<div class="paragraph">
<p>You can also support the project (and RuboCop) with financial contributions via <a href="https://www.patreon.com/bbatsov">Patreon</a>.</p>
</div>
<div class="sect2">
<h3 id="how-to-contribute"><a class="anchor" href="#how-to-contribute"></a><a class="link" href="#how-to-contribute">How to Contribute?</a></h3>
<div class="paragraph">
<p>It&#8217;s easy, just follow the contribution guidelines below:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://help.github.com/articles/fork-a-repo">Fork</a> the <a href="https://github.com/rubocop/rspec-style-guide">project</a> on GitHub</p>
</li>
<li>
<p>Make your feature addition or bug fix in a feature branch</p>
</li>
<li>
<p>Include a <a href="http://tbaggery.com/2008/04/19/a-note-about-git-commit-messages.html">good description</a> of your changes</p>
</li>
<li>
<p>Push your feature branch to GitHub</p>
</li>
<li>
<p>Send a <a href="https://help.github.com/articles/using-pull-requests">Pull Request</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="license"><a class="anchor" href="#license"></a><a class="link" href="#license">License</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p><span class="image"><img src="https://i.creativecommons.org/l/by/3.0/88x31.png" alt="Creative Commons License"></span>
This work is licensed under a <a href="http://creativecommons.org/licenses/by/3.0/deed.en_US">Creative Commons Attribution 3.0 Unported License</a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="credit"><a class="anchor" href="#credit"></a><a class="link" href="#credit">Credit</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Inspiration was taken from the following:</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/howaboutwe/rspec-style-guide">HowAboutWe&#8217;s RSpec style guide</a></p>
</div>
<div class="paragraph">
<p><a href="https://github.com/rubocop-hq/rails-style-guide">Community Rails style guide</a></p>
</div>
<div class="paragraph">
<p>This guide was maintained by <a href="https://github.com/reachlocal">ReachLocal</a> for a long while.</p>
</div>
<div class="paragraph">
<p>This guide includes material originally present in <a href="https://github.com/lelylan/betterspecs">BetterSpecs</a> (<a href="https://lelylan.github.io/betterspecs/">newer site</a> <a href="http://www.betterspecs.org/">older site</a>), sponsored by <a href="https://github.com/lelylan">Lelylan</a> and maintained by <a href="https://github.com/andreareginato">Andrea Reginato</a> and <a href="https://github.com/lelylan/betterspecs/graphs/contributors">many others</a> for a long while.</p>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2022-12-12 17:47:16 UTC
</div>
</div>
</body>
</html>